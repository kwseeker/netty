<mxfile host="Electron" modified="2023-09-22T07:19:41.520Z" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.6.5 Chrome/114.0.5735.243 Electron/25.3.1 Safari/537.36" etag="Jefw-J7onK_G73jqbwz8" version="21.6.5" type="device" pages="2">
  <diagram id="imtYsyNTNiav8lWfhS-_" name="Netty工作流程">
    <mxGraphModel dx="3772" dy="879" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="0" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-194" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1">
          <mxGeometry x="3300" y="1921" width="200" height="239" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-199" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#007FFF;strokeColor=#FF3333;strokeWidth=2;dashed=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-195" target="n1ujcnIcw7S-2mcdyPi6-143" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3540" y="1985" />
              <mxPoint x="3540" y="2760" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-200" value="2 接受连接请求；轮询workGroup childrens （NioEventLoop）&lt;br&gt;选取下一个NioEventLoop，执行客户端Channel与&lt;br&gt;NioEventLoop中Selector的绑定" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontColor=#007FFF;" parent="n1ujcnIcw7S-2mcdyPi6-199" vertex="1" connectable="0">
          <mxGeometry x="-0.6466" y="5" relative="1" as="geometry">
            <mxPoint x="136" y="13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KdEMvQ3-G0uXt4LS4QWu-5" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;dashed=1;strokeColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-73" target="HtaHdFhjI1Y0VL2FBTaY-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="860" y="950" />
              <mxPoint x="860" y="790" />
              <mxPoint x="610" y="790" />
              <mxPoint x="610" y="545" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#0000FF;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="n0XTbSt1qkMDTzajxwat-94" target="n0XTbSt1qkMDTzajxwat-31" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1800" y="2246" as="targetPoint" />
            <Array as="points">
              <mxPoint x="3140" y="3240" />
              <mxPoint x="3140" y="2276" />
              <mxPoint x="1800" y="2276" />
            </Array>
            <mxPoint x="3080" y="3246.0000000000005" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-27" value="第一个任务是执行register0的任务" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#007FFF;" parent="DHawYOpzunJhD3Rds1HB-26" vertex="1" connectable="0">
          <mxGeometry x="-0.853" y="10" relative="1" as="geometry">
            <mxPoint x="80" y="86" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-28" value="1" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#007FFF;" parent="DHawYOpzunJhD3Rds1HB-26" vertex="1" connectable="0">
          <mxGeometry x="-0.8459" y="8" relative="1" as="geometry">
            <mxPoint x="18" y="75" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-1" value="&lt;h1&gt;Netty 工作原理（4.1.35）&lt;br&gt;&lt;/h1&gt;&lt;div&gt;下面以Reactor模式架构组织流程图。&lt;/div&gt;&lt;p&gt;前置知识：&lt;br&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Java Socket / NIO, Linux epoll 原理&lt;/li&gt;&lt;li&gt;Netty重要组件的原理 （Promise 及 Promise的嵌套回调用法，ByteBuf簇类）&lt;br&gt;&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="40" y="19" width="520" height="161" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;curved=1;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-2" target="HtaHdFhjI1Y0VL2FBTaY-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-2" value="服务端启动" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="80" y="200" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-10" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-3" target="HtaHdFhjI1Y0VL2FBTaY-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KdEMvQ3-G0uXt4LS4QWu-9" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-3" target="KdEMvQ3-G0uXt4LS4QWu-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-3" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;EventLoopGroup bossGroup = new &lt;b&gt;NioEventLoopGroup&lt;/b&gt;(3)&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;创建处理连接事件的&lt;b&gt;多路复用器&lt;/b&gt;，储存连接任务的&lt;b&gt;阻塞队列&lt;/b&gt;，及处理客户端连接任务的&lt;b&gt;线程池&lt;/b&gt;（这里创建了３组NioEventLoop, 但是线程池只有１个是共用的）&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="20" y="270" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-5" target="HtaHdFhjI1Y0VL2FBTaY-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-5" value="客户端启动" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3200" y="200" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-6" target="n1ujcnIcw7S-2mcdyPi6-21" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3240" y="360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-6" value="&lt;font style=&quot;font-size: 10px&quot;&gt;EventLoopGroup workerGroup = new NioEventLoopGroup();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;和服务端一样，创建多路复用器(Selector)、存放任务的阻塞队列taskQueue、线程池&lt;br&gt;不过是处理CONNECT和读写事件&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3140" y="280" width="200" height="70" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-7" value="io.netty.channel.nio.NioEventLoopGroup" style="swimlane;startSize=20;" parent="1" vertex="1">
          <mxGeometry x="-520" y="260" width="480" height="220" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-8" value="&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;继承的字段（都来自MultithreadEventExecutorGroup）：&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;children&lt;/b&gt; = {EventExecutor[3]@770}&amp;nbsp;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//NioEventLoopGroup包含一组NioEventLoop(默认2*CpuCore个)&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&amp;nbsp; &amp;nbsp; 0 = {NioEventLoop@781}&amp;nbsp;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//NioEventLoop实现EventExecutor接口&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&amp;nbsp; &amp;nbsp; 1 = {NioEventLoop@782}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&amp;nbsp; &amp;nbsp; 2 = {NioEventLoop@783}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;readonlyChildren&lt;/b&gt; = {Collections$UnmodifiableSet@772}&amp;nbsp; size = 3&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;terminatedChildren&lt;/b&gt; = {AtomicInteger@773} &quot;0&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;terminationFuture&lt;/b&gt; = {DefaultPromise@774} &quot;DefaultPromise@6ddf90b0(incomplete)&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;chooser&lt;/b&gt; = {DefaultEventExecutorChooserFactory$GenericEventExecutorChooser@775} &lt;font color=&quot;#007fff&quot;&gt;//负载均衡&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="HtaHdFhjI1Y0VL2FBTaY-7" vertex="1">
          <mxGeometry y="20" width="480" height="200" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-12" value="&lt;font color=&quot;#007fff&quot;&gt;相关配置&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;dashed=1;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-9" target="HtaHdFhjI1Y0VL2FBTaY-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-14" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-9" target="HtaHdFhjI1Y0VL2FBTaY-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-9" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&amp;lt;clinit&amp;gt;&lt;br&gt;计算默认的Event_Loop数（默认：2×CPU核心数）前面没传参（3）的话这里就使用这个默认值&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="280" y="280" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-11" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&quot;io.netty.availableProcessors&quot;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&quot;io.netty.eventLoopThreads&quot;&lt;/span&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;通过系统属性传入&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="630" y="280" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-21" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;dashed=1;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-13" target="HtaHdFhjI1Y0VL2FBTaY-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="585" y="450" />
              <mxPoint x="585" y="360" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-34" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-13" target="HtaHdFhjI1Y0VL2FBTaY-33" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="600" y="450" />
              <mxPoint x="600" y="610" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-13" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;super(nThreads, executor, selectorProvider, selectStrategyFactory, RejectedExecutionHandlers.reject())&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;nThread=0,executor=null,SelectorProvider.provider(),&lt;br&gt;selectStrategyFactory=DefaultSelectStrategyFactory.INSTANCE&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="280" y="410" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-17" value="涉及的组件" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=20;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fontSize=10;fontColor=#330000;" parent="1" vertex="1">
          <mxGeometry x="630" y="360" width="410" height="200" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-18" value="ThreadFactory -&gt; 当前传null" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;fontSize=10;fontColor=#007FFF;" parent="HtaHdFhjI1Y0VL2FBTaY-17" vertex="1">
          <mxGeometry y="20" width="410" height="30" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-19" value="SelectorProvider -&gt; SelectorProvider.provider() 根据操作系统选择" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;fontSize=10;fontColor=#007FFF;" parent="HtaHdFhjI1Y0VL2FBTaY-17" vertex="1">
          <mxGeometry y="50" width="410" height="30" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-20" value="SelectStrategyFactory  -&gt;  DefaultSelectStrategyFactory.INSTANCE" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;fontSize=10;fontColor=#007FFF;" parent="HtaHdFhjI1Y0VL2FBTaY-17" vertex="1">
          <mxGeometry y="80" width="410" height="30" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-22" value="RejectedExecutionHandler  -&gt;  RejectedExecutionHandlers.reject()" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;fontSize=10;fontColor=#007FFF;" parent="HtaHdFhjI1Y0VL2FBTaY-17" vertex="1">
          <mxGeometry y="110" width="410" height="30" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-23" value="EventExecutorChooserFactory  -&gt;  DefaultEventExecutorChooserFactory.INSTANCE" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;fontSize=10;fontColor=#007FFF;" parent="HtaHdFhjI1Y0VL2FBTaY-17" vertex="1">
          <mxGeometry y="140" width="410" height="30" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-24" value="Promise&lt;?&gt;  -&gt;   new DefaultPromise(GlobalEventExecutor.INSTANCE)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;fontSize=10;fontColor=#007FFF;" parent="HtaHdFhjI1Y0VL2FBTaY-17" vertex="1">
          <mxGeometry y="170" width="410" height="30" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-29" value="&lt;font style=&quot;font-size: 10px&quot;&gt;new GlobalEventExecutor()&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;计划任务线程池，继承JUC AbstractExecutorService&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1080" y="525" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-30" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-24" target="HtaHdFhjI1Y0VL2FBTaY-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-31" value="NioEventLoopGroup.java" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="345" y="260" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-40" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-33" target="HtaHdFhjI1Y0VL2FBTaY-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-33" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;&lt;b&gt;MultithreadEventExecutorGroup&lt;/b&gt;(&lt;br&gt;int nThreads, Executor executor,&lt;/div&gt;&lt;div&gt;EventExecutorChooserFactory chooserFactory, Object... args)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;nThreads为0会默认使用2*CpuCore&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="630" y="580" width="250" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-35" value="io.netty.channel.nio.NioEventLoop (等同于多路复用器Selector＋线程池)" style="swimlane;startSize=20;" parent="1" vertex="1">
          <mxGeometry x="-1080" y="100" width="480" height="560" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-36" value="&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;selectNowSupplier = {NioEventLoop$1@773}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#0000ff&quot;&gt;//核心成员1: selector&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;selector&lt;/b&gt; = {SelectedSelectionKeySetSelector@891}&amp;nbsp;&lt;span&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//经过一层封装的selector&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;unwrappedSelector&lt;/b&gt; = {EPollSelectorImpl@826}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;selectedKeys&lt;/b&gt; = {SelectedSelectionKeySet@863}&amp;nbsp; size = 0&lt;span&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//Channel注册到Selector后的监听描述信息的集合，存储触发的事件集合&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;provider&lt;/b&gt; = {EPollSelectorProvider@671}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;wakenUp = {AtomicBoolean@776} &quot;false&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;selectStrategy&lt;/b&gt; = {DefaultSelectStrategy@672}&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt; //当前看是如果线程池任务队列有任务就选择执行任务，没有就选择执行select(), 由于使用的默认线程池是单线程的，在循环中执行队列任务以及select()的，所以NioEventLoop启动后不要再往线程池加耗时操作（一般都是注册新的Channel,里面不要写耗时操作）&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;ioRatio = 50&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;cancelledKeys = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;needsToSelectAgain = false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;tailTasks = {MpscUnboundedArrayQueue@766}&amp;nbsp; size = 0&lt;/span&gt;&lt;/div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#0000ff&quot;&gt;//核心成员2: taskQueue&lt;/font&gt;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;taskQueue&lt;/b&gt; = {MpscUnboundedArrayQueue@759}&amp;nbsp; size = 0 &lt;font color=&quot;#007fff&quot;&gt;//线程池任务队列，LinkedBlockingQueue&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;scheduledTaskQueue&lt;/b&gt; = null&lt;span&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//计划任务队列&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;thread = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;threadProperties = null&lt;br&gt;&lt;font color=&quot;#0000ff&quot;&gt;//核心成员３：executor&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;executor&lt;/b&gt; = {ThreadExecutorMap$1@706}&amp;nbsp;&lt;span&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//ThreadPerTaskExecutor的代理，执行任务时会&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;interrupted = false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;threadLock = {Semaphore@690} &quot;java.util.concurrent.Semaphore@6276ae34[Permits = 0]&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;shutdownHooks = {LinkedHashSet@693}&amp;nbsp; size = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;addTaskWakesUp = false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;maxPendingTasks = 2147483647&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;rejectedExecutionHandler = {RejectedExecutionHandlers$1@673}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;lastExecutionTime = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;state&lt;/b&gt; = 1&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;gracefulShutdownQuietPeriod = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;gracefulShutdownTimeout = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;gracefulShutdownStartTime = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;terminationFuture = {DefaultPromise@696} &quot;DefaultPromise@3c09711b(incomplete)&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;parent&lt;/b&gt; = {NioEventLoopGroup@669}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;selfCollection = {Collections$SingletonSet@682}&amp;nbsp; size = 1&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="HtaHdFhjI1Y0VL2FBTaY-35" vertex="1">
          <mxGeometry y="20" width="480" height="540" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-69" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-39" target="HtaHdFhjI1Y0VL2FBTaY-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-39" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;executor = new &lt;b&gt;ThreadPerTaskExecutor&lt;/b&gt;(newDefaultThreadFactory())&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;创建线程池线程工厂创建线程的优先级10,非守护线程&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;ThreadPerTaskExecutor会为每个任务新创建一个线程执行&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="920" y="580" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-52" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-41" target="HtaHdFhjI1Y0VL2FBTaY-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-41" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;new &lt;b&gt;NioEventLoop&lt;/b&gt;(this, executor, (SelectorProvider) args[0],&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ((SelectStrategyFactory) args[1]).newSelectStrategy(), (RejectedExecutionHandler) args[2])&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1240" y="680" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-43" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=-0.002;exitY=0.315;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;exitPerimeter=0;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-8" target="HtaHdFhjI1Y0VL2FBTaY-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-560" y="343" />
              <mxPoint x="-560" y="100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-48" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-44" target="HtaHdFhjI1Y0VL2FBTaY-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-44" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;this.executor = ThreadExecutorMap.apply(executor, this);&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;命令交给ThreadPerTaskExecutor创建的线程执行，并记录当前NioEventLoop到此线程的FastThreadLocal，做什么用的？&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1880" y="680" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-46" value="SingleThreadEventExecutor.java" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1635" y="660" width="170" height="20" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-47" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;taskQueue = &lt;/span&gt;&lt;b style=&quot;font-size: 10px&quot;&gt;newTaskQueue&lt;/b&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;(this.maxPendingTasks);&lt;/span&gt;&lt;br&gt;&lt;font style=&quot;font-size: 9px&quot; color=&quot;#007fff&quot;&gt;应该是Selector事件处理任务队列（TODO）&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1880" y="740" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-57" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-49" target="HtaHdFhjI1Y0VL2FBTaY-56" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-63" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-49" target="HtaHdFhjI1Y0VL2FBTaY-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-49" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;final SelectorTuple selectorTuple = &lt;b&gt;openSelector&lt;/b&gt;();&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000ff&quot;&gt;创建Selector&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1560" y="810" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-54" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-51" target="HtaHdFhjI1Y0VL2FBTaY-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-55" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-51" target="HtaHdFhjI1Y0VL2FBTaY-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-51" value="&lt;font&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;super(parent, executor, false, DEFAULT_MAX_PENDING_TASKS, rejectedExecutionHandler)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1560" y="680" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-59" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-56" target="HtaHdFhjI1Y0VL2FBTaY-58" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-56" value="&lt;font&gt;&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;unwrappedSelector = provider.openSelector()&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;font size=&quot;1&quot;&gt;参考NIO流程解析，unwrappedSelector&lt;/font&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;就是EpollSelectorImpl&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1900" y="810" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-61" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-58" target="HtaHdFhjI1Y0VL2FBTaY-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-58" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;selectedKeySet = new &lt;b&gt;SelectedSelectionKeySet&lt;/b&gt;();&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;selectedKeys = selectedKeySet;&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;SelectedSelectionKeySet用于存储触发的事件信息&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1900" y="870" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-60" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;div&gt;return new SelectorTuple(unwrappedSelector,&lt;/div&gt;&lt;div&gt;new &lt;b&gt;SelectedSelectionKeySetSelector&lt;/b&gt;(unwrappedSelector, selectedKeySet))&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;给Selector额外装饰了一层，拓展了selectedKeySet&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1880" y="930" width="280" height="50" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-62" value="&lt;font&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;&lt;b&gt;selector&lt;/b&gt; = selectorTuple.selector;&lt;/div&gt;&lt;div&gt;&lt;b&gt;unwrappedSelector&lt;/b&gt; = selectorTuple.unwrappedSelector;&lt;/div&gt;&lt;div&gt;&lt;b&gt;selectStrategy&lt;/b&gt; = strategy;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1560" y="970" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-66" value="NioEventLoop.java" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1330" y="660" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-67" value="NioEventLoop对比Java NIO EPollSelectorImpl相当于在其基础上重写了SelectionKey集合，然后还提供了多线程异步处理事件的能力（处理逻辑怎么注入的）" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1240" y="720" width="280" height="50" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-70" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-68" target="HtaHdFhjI1Y0VL2FBTaY-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-72" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-68" target="HtaHdFhjI1Y0VL2FBTaY-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-68" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;for&lt;/b&gt;:&lt;br&gt;children[i] = newChild(executor, args)&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;NioEventLoop的数组&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="960" y="680" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-74" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-71" target="HtaHdFhjI1Y0VL2FBTaY-73" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KdEMvQ3-G0uXt4LS4QWu-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-71" target="KdEMvQ3-G0uXt4LS4QWu-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KdEMvQ3-G0uXt4LS4QWu-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;curved=1;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-71" target="KdEMvQ3-G0uXt4LS4QWu-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-71" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&amp;nbsp;chooser = chooserFactory.newChooser(children);&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;相当于负载均衡器？next()轮询选取下一个NioEventLoop&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="940" y="820" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KdEMvQ3-G0uXt4LS4QWu-7" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-73" target="KdEMvQ3-G0uXt4LS4QWu-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-73" value="&lt;font&gt;&lt;div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;for (EventExecutor e: children)&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&amp;nbsp;e.terminationFuture().addListener(terminationListener);&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left ; font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;为每个NioEventLoop注册终止监听器，当它们全部关闭后触发&lt;/span&gt;&lt;br&gt;&lt;span&gt;DefaultPromise(GlobalEventExecutor.INSTANCE)回调&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="920" y="920" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="KdEMvQ3-G0uXt4LS4QWu-1" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;new PowerOfTwoEventExecutorChooser(executors)&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;children元素的个数是２的幂指数时使用&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1240" y="820" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KdEMvQ3-G0uXt4LS4QWu-3" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;new GenericEventExecutorChooser(executors)&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;非2的幂指数时使用&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1240" y="880" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KdEMvQ3-G0uXt4LS4QWu-6" value="&lt;font&gt;&lt;div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;readonlyChildren = Collections.unmodifiableSet(childrenSet)&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="920" y="1000" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KdEMvQ3-G0uXt4LS4QWu-11" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="KdEMvQ3-G0uXt4LS4QWu-8" target="KdEMvQ3-G0uXt4LS4QWu-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KdEMvQ3-G0uXt4LS4QWu-8" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;EventLoopGroup workerGroup = new NioEventLoopGroup(8)&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;和上面一样，只不过是处理连接外的业务事件，这里会再创建１个线程池&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="40" y="420" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;curved=1;" parent="1" source="KdEMvQ3-G0uXt4LS4QWu-10" target="YDD_5_pZ5HoN9TGWr4Hb-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-22" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="1" source="KdEMvQ3-G0uXt4LS4QWu-10" target="YDD_5_pZ5HoN9TGWr4Hb-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KdEMvQ3-G0uXt4LS4QWu-10" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;ServerBootstrap bootstrap = new ServerBootstrap()&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="40" y="560" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;curved=1;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-1" target="YDD_5_pZ5HoN9TGWr4Hb-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;curved=1;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-1" target="YDD_5_pZ5HoN9TGWr4Hb-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-1" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;.group(bossGroup, workerGroup)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(0 , 127 , 255) ; font-size: 10px&quot;&gt;给group、childGroup赋值&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="280" y="680" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-3" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;b&gt;options&lt;/b&gt; = new LinkedHashMap&amp;lt;ChannelOption&amp;lt;?&amp;gt;, Object&amp;gt;()&lt;br&gt;&lt;/font&gt;&lt;b&gt;attrs&lt;/b&gt; = new LinkedHashMap&amp;lt;AttributeKey&amp;lt;?&amp;gt;, Object&amp;gt;()&lt;br&gt;&lt;b&gt;childOptions&lt;/b&gt; = new LinkedHashMap&amp;lt;ChannelOption&amp;lt;?&amp;gt;, Object&amp;gt;()&lt;br&gt;&lt;b&gt;childAttrs&lt;/b&gt; = new LinkedHashMap&amp;lt;AttributeKey&amp;lt;?&amp;gt;, Object&amp;gt;()&lt;br&gt;&lt;b&gt;config&lt;/b&gt; = new ServerBootstrapConfig(this)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="280" y="540" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-7" target="YDD_5_pZ5HoN9TGWr4Hb-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-7" target="YDD_5_pZ5HoN9TGWr4Hb-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-7" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;super.group(parentGroup)&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="680" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-9" target="YDD_5_pZ5HoN9TGWr4Hb-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-9" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;this.group = group&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="720" y="680" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-11" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;return self()&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="720" y="740" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-13" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;this.childGroup = childGroup&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="760" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-18" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-15" target="YDD_5_pZ5HoN9TGWr4Hb-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-20" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-15" target="YDD_5_pZ5HoN9TGWr4Hb-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-15" value="&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;.channel(NioServerSocketChannel.class)&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;给channelFactory赋值&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="260" y="820" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-17" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&amp;nbsp;channelFactory(new &lt;b&gt;ReflectiveChannelFactory&lt;/b&gt;&amp;lt;C&amp;gt;(channelClass))&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;用于创建NioServerSocektChannel的工厂&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="500" y="810" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-25" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-19" target="YDD_5_pZ5HoN9TGWr4Hb-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-27" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-19" target="YDD_5_pZ5HoN9TGWr4Hb-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-19" value="&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;option(ChannelOption.SO_BACKLOG, 1024)&lt;/span&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;给options赋值，连接队列长度&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="260" y="900" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-23" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-21" target="YDD_5_pZ5HoN9TGWr4Hb-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-31" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-21" target="YDD_5_pZ5HoN9TGWr4Hb-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-21" value="&lt;font style=&quot;font-size: 12px&quot;&gt;&lt;span&gt;bootstrap.xxx()&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;对象字段初始化&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="40" y="680" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-24" value="&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;options.put(option, value)&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;options是Map, 存储一些启动参数&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="900" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-29" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-26" target="YDD_5_pZ5HoN9TGWr4Hb-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-26" value="&lt;font&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;/div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;.childHandler(new ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {...}&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;给&lt;/font&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;childHandler赋值&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;ChannelInitializer，用于创建后面的ChannelPipeline时往链表插入ChannelHandler节点&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="260" y="970" width="200" height="70" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#007FFF;dashed=1;curved=1;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-28" target="DHawYOpzunJhD3Rds1HB-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="750" y="1005" />
              <mxPoint x="750" y="1090" />
              <mxPoint x="950" y="1090" />
              <mxPoint x="950" y="1532" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-28" value="&lt;font&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;/div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;this.childHandler = childHandler&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="985" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-35" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-30" target="YDD_5_pZ5HoN9TGWr4Hb-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-39" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-30" target="YDD_5_pZ5HoN9TGWr4Hb-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-30" value="&lt;font&gt;ChannelFuture cf =　bootstrap.bind(9000)&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;创建ServerSocket,绑定端口&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="40" y="1150" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-37" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-34" target="YDD_5_pZ5HoN9TGWr4Hb-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-65" value="同步等待promise结束&lt;br&gt;这里很快就会返回，只是注册ChannelHandler等&lt;br&gt;并没有什么阻塞的操作" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontSize=8;fontColor=#007FFF;strokeColor=#007FFF;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-34" target="YDD_5_pZ5HoN9TGWr4Hb-53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-34" value="&lt;font&gt;&lt;span style=&quot;font-size: 12px&quot;&gt;cf.sync()&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;到这里cf其实是&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;&lt;span&gt;PendingRegistrationPromise&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="40" y="2370" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-26" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-36" target="1IMWfKVCYPNeZjfGsvOy-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-36" value="&lt;font&gt;cf.channel()&lt;br&gt;.closeFuture().sync()&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;等待Channel关闭，TODO&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="40" y="2591" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-41" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-38" target="YDD_5_pZ5HoN9TGWr4Hb-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-38" value="&lt;font&gt;bind(new InetSocketAddress(inetPort))&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="280" y="1150" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-43" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-40" target="YDD_5_pZ5HoN9TGWr4Hb-42" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-40" value="&lt;font&gt;doBind(localAddress)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="1150" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-45" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-42" target="YDD_5_pZ5HoN9TGWr4Hb-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-51" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-42" target="YDD_5_pZ5HoN9TGWr4Hb-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-42" value="&lt;font&gt;　regFuture = initAndRegister()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="720" y="1150" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-47" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-44" target="YDD_5_pZ5HoN9TGWr4Hb-46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-75" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-44" target="YDD_5_pZ5HoN9TGWr4Hb-74" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-44" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;b&gt;&lt;span&gt;channel = channelFactory.&lt;/span&gt;&lt;span&gt;newChannel&lt;/span&gt;&lt;span&gt;()&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;反射通过&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 127 , 255)&quot;&gt;EpollSelectorProvider、&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;创建NioServerSocketChannel (指明要监听OP_ACCEPT事件、要设置非阻塞模式)、初始化pipeline&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;1 服务端SocketChannel创建&lt;/font&gt;&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="960" y="1130" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-49" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-46" target="YDD_5_pZ5HoN9TGWr4Hb-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-71" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-46" target="YDD_5_pZ5HoN9TGWr4Hb-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-46" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;b&gt;init(channel)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;主要是初始化ChannelHandler的pipeline(添加用于注册用户自定义ChannelInitiaizer的ChannelInitializer)&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;2 Channel对象属性初始化&lt;/font&gt;&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="960" y="1240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-52" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-48" target="YDD_5_pZ5HoN9TGWr4Hb-42" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="940" y="2040" />
              <mxPoint x="940" y="1180" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-26" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-48" target="n0XTbSt1qkMDTzajxwat-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-48" value="&lt;font&gt;ChannelFuture &lt;b&gt;regFuture&lt;/b&gt; = config().group().register(channel)&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;&lt;b&gt;轮寻从bossGroup中选择一个NioEventLoop执行注册逻辑&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="960" y="2010" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-54" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-50" target="YDD_5_pZ5HoN9TGWr4Hb-53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-50" value="&lt;font&gt;channel = regFuture.channel()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="720" y="2290.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-56" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-53" target="YDD_5_pZ5HoN9TGWr4Hb-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-53" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;PendingRegistrationPromise &lt;b&gt;promise&lt;/b&gt; = new PendingRegistrationPromise(channel)&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;此promise&lt;font style=&quot;font-size: 8px&quot;&gt;监听regFuture执行结果，完毕才会执行promise及回调&lt;/font&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="680" y="2361" width="240" height="59" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-58" value="失败回调" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;dashed=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-55" target="YDD_5_pZ5HoN9TGWr4Hb-57" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="930" y="2520.5" />
              <mxPoint x="930" y="2480.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-60" value="成功回调" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-55" target="YDD_5_pZ5HoN9TGWr4Hb-59" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-107" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-55" target="HtaHdFhjI1Y0VL2FBTaY-106" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-55" value="&lt;font&gt;regFuture.addListener(new &lt;b&gt;ChannelFutureListener&lt;/b&gt;() {...}&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;注册监听待regFuture执行initAndRegister完毕后执行Listener回调&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="700" y="2490.5" width="200" height="59" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-57" value="&lt;font&gt;&lt;b&gt;promise&lt;/b&gt;.setFailure(cause)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="960" y="2460.5" width="200" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-63" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-59" target="YDD_5_pZ5HoN9TGWr4Hb-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-59" value="&lt;font&gt;&lt;b&gt;promise&lt;/b&gt;.registered()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="960" y="2540.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Q0W_JhSwJ4xSzp8v3iTC-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-62" target="Q0W_JhSwJ4xSzp8v3iTC-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-62" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;doBind0&lt;/b&gt;(regFuture, channel, localAddress, promise)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;回调仍然是在线程池中执行&lt;br&gt;绑定Channel监听的端口并启动监听&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="960" y="2611" width="200" height="59" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-73" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-70" target="YDD_5_pZ5HoN9TGWr4Hb-72" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-70" value="&lt;font&gt;options = options0()&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;SO_BACKLOG: 1024&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1240" y="1210" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-72" target="n0XTbSt1qkMDTzajxwat-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-5" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-72" target="n0XTbSt1qkMDTzajxwat-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-72" value="&lt;font&gt;setChannelOptions(channel, options, logger)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1240" y="1271" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-77" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-74" target="YDD_5_pZ5HoN9TGWr4Hb-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="v9iovkMEOWd9lAaEUpA6-4" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;dashed=1;strokeColor=#007FFF;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-74" target="YDD_5_pZ5HoN9TGWr4Hb-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1340" y="1080" />
              <mxPoint x="770" y="1080" />
              <mxPoint x="770" y="840" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-74" value="&lt;font&gt;channel = channelFactory.&lt;b&gt;newChannel&lt;/b&gt;()&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;反射创建NioServerSocketChannel&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1240" y="1150" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-79" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-76" target="YDD_5_pZ5HoN9TGWr4Hb-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-76" value="&lt;font&gt;NioServerSocketChannel#&amp;lt;init&amp;gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;这个不是NIO中的类，是Netty封装的同名类&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1520" y="1150" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-81" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-78" target="YDD_5_pZ5HoN9TGWr4Hb-80" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-85" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-78" target="YDD_5_pZ5HoN9TGWr4Hb-84" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-78" value="&lt;font&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;b&gt;newSocket&lt;/b&gt;(DEFAULT_SELECTOR_PROVIDER)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1760" y="1150" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-83" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-80" target="YDD_5_pZ5HoN9TGWr4Hb-82" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-87" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#000000;elbow=vertical;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-80" target="YDD_5_pZ5HoN9TGWr4Hb-86" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-80" value="&lt;font&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;&amp;nbsp;super(null, channel, &lt;b&gt;SelectionKey.OP_ACCEPT&lt;/b&gt;)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1760" y="1225" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;curved=1;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-82" target="YDD_5_pZ5HoN9TGWr4Hb-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-84" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-82" target="HtaHdFhjI1Y0VL2FBTaY-83" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-82" value="&lt;font&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;config = new &lt;b&gt;NioServerSocketChannelConfig&lt;/b&gt;(this, javaChannel().socket())&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1760" y="1311" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-84" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;provider.&lt;b&gt;openServerSocketChannel&lt;/b&gt;()&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;通过EpollSelectorProvide创建服务端Socket&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;详细流程参考NIO工作流程分析&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="2000" y="1150" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-13" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-86" target="n0XTbSt1qkMDTzajxwat-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-86" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;this.parent = parent;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;id = newId();&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;unsafe = newUnsafe();&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;pipeline = &lt;b style=&quot;font-size: 10px;&quot;&gt;newChannelPipeline&lt;/b&gt;();&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;this.ch = &lt;b style=&quot;font-size: 10px;&quot;&gt;ch&lt;/b&gt;;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;this.readInterestOp = &lt;b style=&quot;font-size: 10px;&quot;&gt;readInterestOp&lt;/b&gt;;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;ch.&lt;b style=&quot;font-size: 10px;&quot;&gt;configureBlocking&lt;/b&gt;(false);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2000" y="1200" width="200" height="90" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-88" value="io.netty.channel.socket.nio.NioServerSocketChannel" style="swimlane;startSize=20;" parent="1" vertex="1">
          <mxGeometry x="-520" y="1119" width="480" height="500" as="geometry" />
        </mxCell>
        <mxCell id="YDD_5_pZ5HoN9TGWr4Hb-89" value="&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;b&gt;config&lt;/b&gt;&amp;nbsp;= {NioServerSocketChannel$NioServerSocketChannelConfig@1257}&amp;nbsp;&lt;font style=&quot;font-size: 11px&quot; color=&quot;#ff3333&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot; color=&quot;#ff3333&quot;&gt;//继承自AbstractNioMessageChannel&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;inputShutdown = false&lt;/span&gt;&lt;span&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#ff3333&quot;&gt;//继承自AbstractNioChannel&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#0000ff&quot;&gt;//核心成员１：ch 服务端SocketChannel&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;ch&lt;/b&gt; = {&lt;b&gt;ServerSocketChannelImpl&lt;/b&gt;@967} &quot;sun.nio.ch.ServerSocketChannelImpl[unbound]&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;readInterestOp&lt;/b&gt; = 16&lt;span&gt;&#x9;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//关注的事件(bitSet)：16:监听SelectionKey.OP_ACCEPT事件，后面bind0()中注册到selector&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;selectionKey&lt;/b&gt; = null&lt;span&gt;&#x9;&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//Channel注册到Selector后的监听描述信息&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;readPending = false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;clearReadPendingRunnable = {AbstractNioChannel$1@1122}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;connectPromise = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;connectTimeoutFuture = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;requestedRemoteAddress = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#ff3333&quot;&gt;//继承自AbstractChannel&lt;/font&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;parent = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;id&lt;/b&gt; = {DefaultChannelId@1027} &quot;d86c415a&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;unsafe&lt;/b&gt; = {AbstractNioMessageChannel$NioMessageUnsafe@1075}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#0000ff&quot;&gt;//核心成员２：pipeline ChannelHandler双向链表，与Channel是1对1的关系，NioSocketChannel同理&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;pipeline&lt;/b&gt; = {DefaultChannelPipeline@1114} &quot;DefaultChannelPipeline{}&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;unsafeVoidPromise = {VoidChannelPromise@989}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;closeFuture = {AbstractChannel$CloseFuture@993} &quot;AbstractChannel$CloseFuture@424c0bc4(incomplete)&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;localAddress = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;remoteAddress = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;eventLoop = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;registered = false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;closeInitiated = false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;initialCloseCause = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;strValActive = false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;strVal = &quot;[id: 0xd86c415a]&quot;&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;font color=&quot;#ff3333&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;//继承自&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;DefaultAttributeMap&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;attributes = null&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="YDD_5_pZ5HoN9TGWr4Hb-88" vertex="1">
          <mxGeometry y="21" width="480" height="479" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-1" value="&lt;font&gt;channel.config().setOption(&lt;br&gt;(ChannelOption&amp;lt;Object&amp;gt;) option, value)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1440" y="1271" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-7" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="n0XTbSt1qkMDTzajxwat-4" target="n0XTbSt1qkMDTzajxwat-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-4" value="&lt;font&gt;attrs = attrs0()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;测试中为空&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1240" y="1330.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-9" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="n0XTbSt1qkMDTzajxwat-6" target="n0XTbSt1qkMDTzajxwat-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-6" value="&lt;font&gt;channel.attr(key).set(e.getValue())&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1220" y="1391" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-8" target="DHawYOpzunJhD3Rds1HB-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-8" value="&lt;font&gt;ChannelPipeline &lt;b&gt;p&lt;/b&gt; = channel.pipeline()&lt;br&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;获取前面创建的只有head和tail节点的DefaultChannelPipeline&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1200" y="1450" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-117" value="ChannelInitializer&lt;br&gt;内部实现" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;dashed=1;" parent="1" source="n0XTbSt1qkMDTzajxwat-10" target="HtaHdFhjI1Y0VL2FBTaY-124" edge="1">
          <mxGeometry x="0.2851" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-86" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n0XTbSt1qkMDTzajxwat-10" target="HtaHdFhjI1Y0VL2FBTaY-85" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-10" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&amp;nbsp;&lt;b&gt;p.addLast&lt;/b&gt;(new &lt;b&gt;ChannelInitializer&lt;/b&gt;&amp;lt;Channel&amp;gt;() {...}&lt;br&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;用户定制的ChannelInitializer是通过这里&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;new的ChannelInitializer注册的&lt;br&gt;注册是通过提交异步任务注册&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1220" y="1580.75" width="200" height="79.25" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-18" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="n0XTbSt1qkMDTzajxwat-12" target="n0XTbSt1qkMDTzajxwat-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-12" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;new &lt;b&gt;DefaultChannelPipeline&lt;/b&gt;(this)&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;AbstractChannelHandlerContext的&lt;br&gt;双向链表，此时只有一个head一个tail&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2240" y="1225" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-14" value="io.netty.channel.DefaultChannelPipeline" style="swimlane;startSize=20;" parent="1" vertex="1">
          <mxGeometry x="-1080" y="1119" width="480" height="300" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-15" value="&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;&lt;font color=&quot;#007fff&quot;&gt;//核心成员１：head &amp;amp; tail, 已注册的ChannelHandler双向链表&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;head&lt;/b&gt; = {DefaultChannelPipeline$HeadContext@1425} &quot;ChannelHandlerContext(DefaultChannelPipeline$HeadContext#0, [id: 0xd86c415a])&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;tail&lt;/b&gt; = {DefaultChannelPipeline$TailContext@1426} &quot;ChannelHandlerContext(DefaultChannelPipeline$TailContext#0, [id: 0xd86c415a])&quot;&lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;&lt;font color=&quot;#007fff&quot;&gt;//核心成员2：channel, 此pipeline对应的Channel,即每个Channel有自己的pipeline&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;channel&lt;/b&gt; = {NioServerSocketChannel@976} &quot;[id: 0xd86c415a]&quot; &lt;font color=&quot;#007fff&quot;&gt;//对于服务端SocketChannel即ServerSocketChannel&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;succeededFuture = {SucceededChannelFuture@1427}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;voidPromise = {VoidChannelPromise@1428}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;touch = true&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;childExecutors = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;estimatorHandle = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;firstRegistration = true&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b style=&quot;font-size: 10px&quot;&gt;//核心成员3：&lt;/b&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;pendingHandlerCallbackHead&lt;/b&gt;&lt;/span&gt;&lt;b style=&quot;font-size: 10px&quot;&gt;,&amp;nbsp;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;pendingHandlerCallbackHead&lt;/b&gt; = null&lt;span&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//存储待处理的ChannelHandler节点的链表&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;registered = false&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="n0XTbSt1qkMDTzajxwat-14" vertex="1">
          <mxGeometry y="20" width="480" height="280" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-16" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0;entryDx=0;entryDy=0;exitX=-0.002;exitY=0.561;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="YDD_5_pZ5HoN9TGWr4Hb-89" target="n0XTbSt1qkMDTzajxwat-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-520" y="1349" as="sourcePoint" />
            <mxPoint x="-600" y="1109" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-560" y="1409" />
              <mxPoint x="-560" y="1119" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-78" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#FF3333;" parent="1" source="n0XTbSt1qkMDTzajxwat-17" target="HtaHdFhjI1Y0VL2FBTaY-77" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-17" value="&lt;font&gt;&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;div&gt;&lt;div&gt;this.channel = ObjectUtil.checkNotNull(channel, &quot;channel&quot;);&lt;/div&gt;&lt;div&gt;succeededFuture = new SucceededChannelFuture(channel, null);&lt;/div&gt;&lt;div&gt;voidPromise =&amp;nbsp; new VoidChannelPromise(channel, true);&lt;/div&gt;&lt;div&gt;tail = new TailContext(this);&lt;/div&gt;&lt;div&gt;head = new HeadContext(this);&lt;/div&gt;&lt;div&gt;head.next = tail;&lt;/div&gt;&lt;div&gt;tail.prev = head;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2480" y="1205" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-109" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=11;fontColor=#007FFF;strokeColor=#0000FF;" parent="1" source="n0XTbSt1qkMDTzajxwat-19" target="HtaHdFhjI1Y0VL2FBTaY-85" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2080" y="2001" />
              <mxPoint x="2080" y="1740" />
              <mxPoint x="1480" y="1740" />
              <mxPoint x="1480" y="1475" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-31" value="4" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#007FFF;" parent="HtaHdFhjI1Y0VL2FBTaY-109" vertex="1" connectable="0">
          <mxGeometry x="-0.7913" y="-1" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="SU1bIEB32mpXXK62h1h6-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#007FFF;dashed=1;" parent="1" source="n0XTbSt1qkMDTzajxwat-19" target="n1ujcnIcw7S-2mcdyPi6-173" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3240" y="2021" />
              <mxPoint x="3240" y="3042" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="SU1bIEB32mpXXK62h1h6-3" value="5" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#007FFF;" parent="SU1bIEB32mpXXK62h1h6-2" vertex="1" connectable="0">
          <mxGeometry x="-0.9905" y="-4" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-19" value="&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;div&gt;&lt;div&gt;pipeline.&lt;b&gt;addLast&lt;/b&gt;(new &lt;b&gt;ServerBootstrapAcceptor&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;ch, currentChildGroup, &lt;b&gt;currentChildHandler&lt;/b&gt;, currentChildOptions, currentChildAttrs))&lt;/div&gt;&lt;/div&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;将ChannelHandler封装成ChannelHandlerContext添加到pipeline双向链表末尾&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1800" y="1961" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-28" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="n0XTbSt1qkMDTzajxwat-25" target="n0XTbSt1qkMDTzajxwat-27" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1320" y="2100.5" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-25" value="&lt;font&gt;new &lt;b&gt;DefaultChannelPromise&lt;/b&gt;(channel, this)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1220" y="2020.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-30" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="n0XTbSt1qkMDTzajxwat-27" target="n0XTbSt1qkMDTzajxwat-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-103" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n0XTbSt1qkMDTzajxwat-27" target="HtaHdFhjI1Y0VL2FBTaY-102" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-27" value="&lt;font&gt;promise.channel().unsafe().register(&lt;br&gt;this, promise)&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;往多路复用器中注册SocketChannel&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1220" y="2110.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-34" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="n0XTbSt1qkMDTzajxwat-29" target="n0XTbSt1qkMDTzajxwat-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-29" value="&lt;font&gt;AbstractChannel.this.eventLoop = eventLoop&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;向Channel中记录Channel注册到的NioEventLoop(即Selector), 后面会用到&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1460" y="2110.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-48" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="n0XTbSt1qkMDTzajxwat-31" target="n0XTbSt1qkMDTzajxwat-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-31" value="&lt;font&gt;register0(promise)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1720" y="2199.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-35" value="Y，已经启动" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="n0XTbSt1qkMDTzajxwat-33" target="n0XTbSt1qkMDTzajxwat-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-39" value="&lt;font style=&quot;font-size: 10px&quot;&gt;N，&lt;span style=&quot;background-color: rgb(248 , 249 , 250)&quot;&gt;初始启动执行&lt;/span&gt;&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="n0XTbSt1qkMDTzajxwat-33" target="n0XTbSt1qkMDTzajxwat-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1560" y="2379.5" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-33" value="&lt;font style=&quot;font-size: 10px&quot;&gt;eventLoop&lt;br&gt;.inEventLoop()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;eventLoop线程是否启动&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="1500" y="2199.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-43" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="1" source="n0XTbSt1qkMDTzajxwat-38" target="n0XTbSt1qkMDTzajxwat-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-53" value="首次&lt;br&gt;执行" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="n0XTbSt1qkMDTzajxwat-38" target="n0XTbSt1qkMDTzajxwat-52" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-38" value="&lt;font&gt;&lt;b&gt;eventLoop.execute(...)&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcc99;strokeColor=#36393d;" parent="1" vertex="1">
          <mxGeometry x="1460" y="2420.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-42" value="首次执行提交的任务task" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;dashed=1;" parent="1" source="n0XTbSt1qkMDTzajxwat-52" target="n0XTbSt1qkMDTzajxwat-31" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1900" y="2300.5" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-104" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-47" target="n0XTbSt1qkMDTzajxwat-103" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-109" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-47" target="n0XTbSt1qkMDTzajxwat-108" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2000" y="2379.5" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-47" value="&lt;font&gt;&lt;b&gt;doRegister()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;１Channel和Selector绑定&lt;/font&gt;&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1920" y="2199.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-49" value="io.netty.channel.AbstractChannel.AbstractUnsafe" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1210" y="2090.5" width="230" height="20" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-55" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="n0XTbSt1qkMDTzajxwat-52" target="n0XTbSt1qkMDTzajxwat-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-52" value="&lt;font style=&quot;font-size: 8px&quot;&gt;addTask(task)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;task：比如上面的register0, 加入到NioEventLoop &lt;b&gt;taskQueue&lt;/b&gt;任务队列&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1720" y="2420.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-59" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="n0XTbSt1qkMDTzajxwat-54" target="n0XTbSt1qkMDTzajxwat-58" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-54" value="&lt;font style=&quot;font-size: 8px&quot;&gt;startThread()&lt;br&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;启动NioEventLoop的executor,前面知道这个&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;executor就是ThreadPerTaskExecutor的代理&lt;br&gt;这个executor额外会在工作线程执行任务前在线程本地记录自己，并在执行完毕清除&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1700" y="2479.5" width="200" height="70.5" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-57" value="&lt;h1&gt;&lt;span style=&quot;font-size: 12px ; font-weight: 400&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;说明：&lt;br&gt;&lt;ul&gt;&lt;li&gt;childHandler() 用于给将ChannelHandler注册到子Channel, 这个子Channel指的是用于数据传输的SocketChannel, 对应的服务器端的父Channel是用于监听的ServerSocketChannel&lt;/li&gt;&lt;/ul&gt;&lt;/font&gt;&lt;/span&gt;&lt;/h1&gt;&lt;h1&gt;&lt;span style=&quot;font-size: 12px ; font-weight: 400&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;可参考学习内容：&lt;/font&gt;&lt;/span&gt;&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;font color=&quot;#007fff&quot;&gt;并发同步控制（状态标志+CAS）&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font color=&quot;#007fff&quot;&gt;JDK FieldUpdater（AtomicReferenceFieldUpdater等）&lt;br&gt;&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font color=&quot;#007fff&quot;&gt;Netty FastThreadLocal&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font color=&quot;#007fff&quot;&gt;...&lt;/font&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="560" y="19" width="760" height="221" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-61" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="n0XTbSt1qkMDTzajxwat-58" target="n0XTbSt1qkMDTzajxwat-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-58" value="&lt;font style=&quot;font-size: 11px&quot;&gt;STATE标志＋CAS并发控制下：&lt;br&gt;doStartThread()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1920" y="2494.75" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-63" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;dashed=1;" parent="1" source="n0XTbSt1qkMDTzajxwat-60" target="n0XTbSt1qkMDTzajxwat-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-60" value="&lt;font&gt;executor.execute(new Runnable() {...}&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;实际用的还是ThreadPerTaskExecutor执行,即会创建一个线程&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2120" y="2460.5" width="160" height="74.75" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-65" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="1" source="n0XTbSt1qkMDTzajxwat-62" target="n0XTbSt1qkMDTzajxwat-64" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-67" style="edgeStyle=entityRelationEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;shape=link;width=3.333333333333332;strokeColor=#00CC66;" parent="1" source="n0XTbSt1qkMDTzajxwat-62" target="n0XTbSt1qkMDTzajxwat-66" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-62" value="&lt;font&gt;&amp;nbsp;SingleThreadEventExecutor.this.run()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2320" y="2477.88" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-64" value="&lt;font&gt;finally:&lt;br&gt;...&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2320" y="2539.5" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-69" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;curved=1;" parent="1" source="n0XTbSt1qkMDTzajxwat-66" target="n0XTbSt1qkMDTzajxwat-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-66" value="&lt;div style=&quot;&quot;&gt;&lt;b style=&quot;&quot;&gt;NioEventLoop#run()&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;1）register阶段：注册ChannelHandler到pipeline；&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;2）doBind0阶段，绑定IP端口监听连接；&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;3）监听事件（连接请求）并处理&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fa6800;strokeColor=#C73500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="2040" y="2586.5" width="200" height="69" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-96" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;dashed=1;" parent="1" source="n0XTbSt1qkMDTzajxwat-68" target="n0XTbSt1qkMDTzajxwat-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-17" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-68" target="DHawYOpzunJhD3Rds1HB-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2400" y="2640" />
              <mxPoint x="2480" y="2640" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-68" value="&lt;font&gt;for(;;) start&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2320" y="2611" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-70" value="&lt;font&gt;for(;;) end&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2320" y="3260" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-76" value="SelectStrategy&lt;br&gt;.CONTINUE(-2)" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-73" target="n0XTbSt1qkMDTzajxwat-75" edge="1">
          <mxGeometry x="0.5614" y="-10" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2580" y="2888" />
              <mxPoint x="2580" y="2800" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-77" value="SelectStrategy&lt;br&gt;.BUSY_WAIT(-3)" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="n0XTbSt1qkMDTzajxwat-73" target="n0XTbSt1qkMDTzajxwat-78" edge="1">
          <mxGeometry x="0.4048" relative="1" as="geometry">
            <mxPoint x="2559.8888888888887" y="2840" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-81" value="SelectStrategy&lt;br&gt;.SELECT(-1)&lt;br&gt;即没有就绪任务" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;fontStyle=1" parent="1" source="n0XTbSt1qkMDTzajxwat-73" target="n0XTbSt1qkMDTzajxwat-79" edge="1">
          <mxGeometry x="0.4186" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-82" value="default" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-73" target="n0XTbSt1qkMDTzajxwat-80" edge="1">
          <mxGeometry x="0.3966" y="20" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2580" y="2888" />
              <mxPoint x="2580" y="2980" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PHfMGQpCaa9Q0VLSc77i-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="n0XTbSt1qkMDTzajxwat-73" target="PHfMGQpCaa9Q0VLSc77i-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-73" value="&lt;span style=&quot;font-size: 10px&quot;&gt;switch &lt;br&gt;SelectStrategy&lt;/span&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="2420" y="2868" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-75" value="&lt;font&gt;continue&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;跳出执行下一循环&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2680" y="2780" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-85" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-78" target="n0XTbSt1qkMDTzajxwat-83" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2890" y="2860" />
              <mxPoint x="2890" y="3010" />
              <mxPoint x="2760" y="3010" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-78" value="&lt;font&gt;do nothing&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2680" y="2840" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-79" target="DHawYOpzunJhD3Rds1HB-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-79" value="&lt;font&gt;&lt;b&gt;select&lt;/b&gt;(wakenUp.getAndSet(false))&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;事件监听&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2680" y="2900" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-84" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-80" target="n0XTbSt1qkMDTzajxwat-83" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-80" value="&lt;font&gt;do nothing&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2680" y="2960" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-88" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-83" target="n0XTbSt1qkMDTzajxwat-87" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-191" style="edgeStyle=entityRelationEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#97D077;strokeWidth=1;shape=link;" parent="1" source="n0XTbSt1qkMDTzajxwat-83" target="n1ujcnIcw7S-2mcdyPi6-128" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="SU1bIEB32mpXXK62h1h6-1" value="详细参考右边" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="n1ujcnIcw7S-2mcdyPi6-191" vertex="1" connectable="0">
          <mxGeometry x="-0.9333" y="-2" relative="1" as="geometry">
            <mxPoint x="8" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-83" value="&lt;font&gt;&lt;b&gt;processSelectedKeys()&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2680" y="3040" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-90" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-87" target="n0XTbSt1qkMDTzajxwat-89" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-99" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-87" target="n0XTbSt1qkMDTzajxwat-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-87" value="&lt;font&gt;&lt;b&gt;runAllTasks&lt;/b&gt;(ioTime * (100 - ioRatio) / ioRatio)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;Channel注册等任务&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2680" y="3100" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-92" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-89" target="n0XTbSt1qkMDTzajxwat-91" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-89" value="&lt;font&gt;fetchFromScheduledTaskQueue()&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;从计划任务队列获取任务加入task队列&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2880" y="3100" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-25" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-91" target="n0XTbSt1qkMDTzajxwat-94" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-91" value="&lt;font&gt;Runnable task = pollTask()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2880" y="3160" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-98" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-94" target="n0XTbSt1qkMDTzajxwat-87" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;strokeColor=#007FFF;" parent="1" source="n0XTbSt1qkMDTzajxwat-94" target="Q0W_JhSwJ4xSzp8v3iTC-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3080" y="3244.0000000000005" as="sourcePoint" />
            <mxPoint x="1240" y="2742.5" as="targetPoint" />
            <Array as="points">
              <mxPoint x="3110" y="3240" />
              <mxPoint x="3110" y="3004" />
              <mxPoint x="1220" y="3004" />
              <mxPoint x="1220" y="2739" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="SU1bIEB32mpXXK62h1h6-4" value="&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;第二个任务是执行端口绑定与连接监听&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="n1ujcnIcw7S-2mcdyPi6-3" vertex="1" connectable="0">
          <mxGeometry x="-0.9623" y="1" relative="1" as="geometry">
            <mxPoint x="81" y="-54" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-94" value="&lt;font&gt;task.run()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2880" y="3220" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-102" value="AbstractNioChannel.java" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1935" y="2179.5" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-106" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-103" target="n0XTbSt1qkMDTzajxwat-105" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-103" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;for:&lt;br&gt;selectionKey&lt;/b&gt; = javaChannel()&lt;br&gt;.&lt;b&gt;register&lt;/b&gt;(eventLoop().unwrappedSelector(), 0, this)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;即将NioServerSocketChannel的ch(ServerSocketChannelImpl)注册到负载均衡器Selector中监听，要监听的事件通过attr对象传递（select()时才启动监听），selectionKey存入&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;&lt;span&gt;NioServerSocketChannel&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="2120" y="2170" width="280" height="100" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-105" value="&lt;font&gt;&lt;b&gt;k.attach(attachment)&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2440" y="2199" width="160" height="41" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-112" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-108" target="n0XTbSt1qkMDTzajxwat-111" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-120" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-108" target="n0XTbSt1qkMDTzajxwat-119" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-108" value="&lt;font&gt;&lt;b&gt;pipeline.invokeHandlerAddedIfNeeded()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;２ChannelPipeline后置处理&lt;/font&gt;&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1880" y="2280.5" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-110" value="ServerBootStrap.java" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1265" y="1190" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-114" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-111" target="n0XTbSt1qkMDTzajxwat-113" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-111" value="&lt;font&gt;callHandlerAddedForAllHandlers()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2160" y="2280.5" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-113" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=11;fontColor=#007FFF;strokeColor=#0000FF;" parent="1" source="n0XTbSt1qkMDTzajxwat-113" target="HtaHdFhjI1Y0VL2FBTaY-114" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2650" y="2301" />
              <mxPoint x="2650" y="1700" />
              <mxPoint x="2200" y="1700" />
              <mxPoint x="2200" y="1661" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-29" value="2" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#007FFF;" parent="HtaHdFhjI1Y0VL2FBTaY-113" vertex="1" connectable="0">
          <mxGeometry x="-0.8225" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-113" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;registered = true；&lt;br&gt;&lt;/b&gt;循环执行&lt;b&gt;pendingHandlerCallbackHead&lt;/b&gt;中所有回调任务的execute()方法&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2420" y="2280.5" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-118" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;dashed=1;" parent="1" source="n0XTbSt1qkMDTzajxwat-115" target="n0XTbSt1qkMDTzajxwat-19" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1800" y="2000.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-115" value="&lt;font&gt;ch.eventLoop().execute(new Runnable() {...}&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;向NioEventLoop线程池添加任务&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1500" y="1980" width="260" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-121" value="回调" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#007FFF;dashed=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="n0XTbSt1qkMDTzajxwat-119" target="YDD_5_pZ5HoN9TGWr4Hb-55" edge="1">
          <mxGeometry x="-0.1009" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1780" y="2360" />
              <mxPoint x="800" y="2359" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-124" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-119" target="n0XTbSt1qkMDTzajxwat-123" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-128" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n0XTbSt1qkMDTzajxwat-119" target="n0XTbSt1qkMDTzajxwat-127" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-119" value="&lt;font&gt;promise.trySuccess()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1920" y="2339.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;" parent="1" source="n0XTbSt1qkMDTzajxwat-123" target="n1ujcnIcw7S-2mcdyPi6-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-123" value="&lt;font&gt;pipeline.fireChannelRegistered()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1900" y="2399.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n0XTbSt1qkMDTzajxwat-127" value="&lt;font&gt;AbstractChannelHandlerContext&lt;br&gt;.&lt;b&gt;invokeChannelRegistered&lt;/b&gt;(head)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2160" y="2339.5" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-75" value="io.netty.channel.DefaultChannelPipeline.HeadContext" style="swimlane;startSize=20;" parent="1" vertex="1">
          <mxGeometry x="-1640" y="1119" width="480" height="300" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-76" value="&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;unsafe&lt;/b&gt; = {AbstractNioMessageChannel$NioMessageUnsafe@1045}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;this$0 = {DefaultChannelPipeline@1046} &quot;DefaultChannelPipeline{}&quot; &lt;font color=&quot;#007fff&quot;&gt;//HeadContext是DefaultChannelPipeline的内部类&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;font color=&quot;#ff3333&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;//继承自&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;AbstractChannelHandlerContext&lt;/span&gt;&lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;next&lt;/b&gt; = {DefaultChannelPipeline$TailContext@1054} &quot;ChannelHandlerContext(DefaultChannelPipeline$TailContext#0, [id: 0x74e39d74])&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;prev&lt;/b&gt; = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;pipeline&lt;/b&gt; = {DefaultChannelPipeline@1046} &quot;DefaultChannelPipeline{}&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;name = &quot;DefaultChannelPipeline$HeadContext#0&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;ordered = true&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;executionMask&lt;/b&gt; = 131071&lt;span style=&quot;white-space: pre&quot;&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//可执行方法的位标志&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;executor = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;succeededFuture = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;invokeTasks = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;handlerState = 2&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="HtaHdFhjI1Y0VL2FBTaY-75" vertex="1">
          <mxGeometry y="20" width="480" height="280" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-80" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#FF3333;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-77" target="HtaHdFhjI1Y0VL2FBTaY-79" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-77" value="&lt;font style=&quot;font-size: 12px&quot;&gt;&lt;div style=&quot;font-size: 12px&quot;&gt;&lt;span style=&quot;font-size: 12px&quot;&gt;this.&lt;b&gt;executionMask&lt;/b&gt; = mask(handlerClass)&lt;/span&gt;&lt;br style=&quot;font-size: 12px&quot;&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="2240" y="1351" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-79" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;div style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;mask = mask0(clazz)&lt;/span&gt;&lt;br style=&quot;font-size: 12px;&quot;&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;" parent="1" vertex="1">
          <mxGeometry x="2480" y="1351" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-81" value="io.netty.channel.NioServerSocketChannel$NioServerSocketChannelConfig" style="swimlane;startSize=20;" parent="1" vertex="1">
          <mxGeometry x="-1080" y="1480" width="480" height="300" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-82" value="&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// SocksSocketImpl实例&lt;/font&gt;&lt;br&gt;&lt;b&gt;javaSocket&lt;/b&gt; = {ServerSocketAdaptor@1473} &quot;ServerSocket[unbound]&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;// 已请求连接但是未就绪的连接队列长度&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;backlog&lt;/b&gt; = 128&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;channel&lt;/b&gt; = {NioServerSocketChannel@922} Object is being initialized&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;allocator&lt;/b&gt; = {PooledByteBufAllocator@1514} &quot;PooledByteBufAllocator(directByDefault: true)&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;rcvBufAllocator&lt;/b&gt; = {AdaptiveRecvByteBufAllocator@1515}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;msgSizeEstimator = {DefaultMessageSizeEstimator@1516}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;connectTimeoutMillis = 30000&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;writeSpinCount = 16&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;autoRead = 1&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;autoClose = true&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;writeBufferWaterMark = {WriteBufferWaterMark@1517} &quot;WriteBufferWaterMark(low: 32768, high: 65536)&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;pinEventExecutor = true&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="HtaHdFhjI1Y0VL2FBTaY-81" vertex="1">
          <mxGeometry y="20" width="480" height="280" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-83" value="&lt;font&gt;&lt;font size=&quot;1&quot;&gt;this.socket = ServerSocketAdaptor.create(this)&lt;br&gt;&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;前面已经创建了socket实例了，这里不会再创建了&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2000" y="1306.5" width="200" height="49" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-88" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-85" target="HtaHdFhjI1Y0VL2FBTaY-87" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-111" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-85" target="HtaHdFhjI1Y0VL2FBTaY-110" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-85" value="&lt;font&gt;newCtx = newContext(group, filterName(name, handler), handler);&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;将new的ChannelInitializer(实现ChannelHandler接口)封装成DefaultChannelHandlerContext&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1500" y="1430" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-90" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-87" target="HtaHdFhjI1Y0VL2FBTaY-89" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-87" value="&lt;font&gt;addLast0(newCtx);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;插入到双向链表tail节点之前&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1550" y="1511.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-92" value="Y" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-89" target="HtaHdFhjI1Y0VL2FBTaY-91" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-96" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;N&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;bind阶段执行callHandlerAddedForAllHandlers()&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;会设置registered为true，&lt;br&gt;即右边的逻辑只会执行一次&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;也即ServerBootstrapAcceptor注册任务会走这里&lt;/font&gt;&lt;/div&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-89" target="HtaHdFhjI1Y0VL2FBTaY-99" edge="1">
          <mxGeometry x="-0.0026" relative="1" as="geometry">
            <mxPoint x="1630" y="1670.5" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-89" value="!registered" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1580" y="1570.5" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-94" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-91" target="HtaHdFhjI1Y0VL2FBTaY-93" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-91" value="&lt;font&gt;newCtx.setAddPending()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1740" y="1571.25" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-98" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-93" target="HtaHdFhjI1Y0VL2FBTaY-97" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-101" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-93" target="HtaHdFhjI1Y0VL2FBTaY-100" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-93" value="&lt;font&gt;callHandlerCallbackLater(&lt;br&gt;newCtx, true)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;异步注册ChannelHandler&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1740" y="1631.25" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-115" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#007FFF;strokeColor=#330000;dashed=1;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-97" target="HtaHdFhjI1Y0VL2FBTaY-114" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-97" value="&lt;font&gt;向链表pendingHandlerCallbackHead中添加任务&lt;b&gt;PendingHandlerAddedTask&lt;/b&gt;(ctx)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;后面register阶段执行&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1940" y="1631.75" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="SU1bIEB32mpXXK62h1h6-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-99" target="SU1bIEB32mpXXK62h1h6-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-99" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;callHandlerAdded0(newCtx)&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;retrun this;&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1540" y="1750" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-100" value="&lt;font&gt;return this;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1740" y="1690.75" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-104" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-102" target="YDD_5_pZ5HoN9TGWr4Hb-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-102" value="&lt;font&gt;return promise;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1220" y="2190.5" width="200" height="39.5" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-106" value="&lt;font&gt;return promise;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="720" y="2571" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-110" value="&lt;font&gt;new &lt;b&gt;DefaultChannelHandlerContext&lt;/b&gt;(this, childExecutor(group), name, handler)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1800" y="1440" width="260" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-117" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-114" target="HtaHdFhjI1Y0VL2FBTaY-116" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-114" value="&lt;font&gt;callHandlerAdded0(ctx)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2220" y="1631.25" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-119" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=11;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-116" target="HtaHdFhjI1Y0VL2FBTaY-118" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-116" value="&lt;font&gt;ctx.callHandlerAdded()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2420" y="1631.25" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-123" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-118" target="HtaHdFhjI1Y0VL2FBTaY-122" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-118" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;if (setAddComplete()) {&lt;/div&gt;&lt;div&gt;handler().&lt;b&gt;handlerAdded&lt;/b&gt;(this);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;判断handlerState&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="2620" y="1620.75" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-120" value="DefaultChannelPipeline.java" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=11;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2220" y="1611.75" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-121" value="AbstractChannelHandlerContext.java" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=11;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2395" y="1611.25" width="210" height="20" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-128" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#0000FF;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-122" target="HtaHdFhjI1Y0VL2FBTaY-124" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3080" y="1651" />
              <mxPoint x="3080" y="1840" />
              <mxPoint x="1500" y="1840" />
              <mxPoint x="1500" y="1880" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-30" value="3" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#007FFF;" parent="HtaHdFhjI1Y0VL2FBTaY-128" vertex="1" connectable="0">
          <mxGeometry x="-0.7463" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-122" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;if (initChannel(ctx)) {&lt;/div&gt;&lt;div&gt;&lt;b&gt;//执行完initChannel, 然后删除掉Initializer&lt;/b&gt;&lt;/div&gt;&lt;div&gt;removeState(ctx);&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="2860" y="1621.5" width="200" height="59.5" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-127" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-124" target="HtaHdFhjI1Y0VL2FBTaY-125" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-124" value="&lt;font&gt;initChannel(final Channel ch)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1520" y="1860" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-126" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-125" target="n0XTbSt1qkMDTzajxwat-115" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-125" value="&lt;font&gt;ChannelHandler handler = config.handler()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1520" y="1921" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="HtaHdFhjI1Y0VL2FBTaY-129" value="ServerBootStrap$ChannelInitializer.java" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1530" y="1840" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Q0W_JhSwJ4xSzp8v3iTC-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;curved=1;" parent="1" source="Q0W_JhSwJ4xSzp8v3iTC-1" target="Q0W_JhSwJ4xSzp8v3iTC-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-23" value="&lt;font color=&quot;#007fff&quot;&gt;提交到此Channel分配到的NioEventLoop的线程池执行&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;dashed=1;strokeColor=#007FFF;" parent="1" source="Q0W_JhSwJ4xSzp8v3iTC-1" target="n0XTbSt1qkMDTzajxwat-66" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Q0W_JhSwJ4xSzp8v3iTC-1" value="&lt;font&gt;channel.eventLoop().execute(...)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;b&gt;提交&lt;/b&gt;的任务执行bind()并注册CLOSE_ON_FAILURE监听&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1200" y="2620.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Q0W_JhSwJ4xSzp8v3iTC-10" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Q0W_JhSwJ4xSzp8v3iTC-5" target="Q0W_JhSwJ4xSzp8v3iTC-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Q0W_JhSwJ4xSzp8v3iTC-12" value="Y" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Q0W_JhSwJ4xSzp8v3iTC-5" target="Q0W_JhSwJ4xSzp8v3iTC-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Q0W_JhSwJ4xSzp8v3iTC-5" value="regFuture&lt;br&gt;.isSuccess()" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1240" y="2708.5" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="H4OvdQoWyoAmilvTNFpG-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;curved=1;" parent="1" source="Q0W_JhSwJ4xSzp8v3iTC-7" target="H4OvdQoWyoAmilvTNFpG-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Q0W_JhSwJ4xSzp8v3iTC-7" value="&lt;font&gt;channel.bind(localAddress, promise)&lt;br&gt;.addListener(ChannelFutureListener&lt;br&gt;.CLOSE_ON_FAILURE)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1400" y="2748.5" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Q0W_JhSwJ4xSzp8v3iTC-9" value="&lt;font&gt;promise.setFailure(regFuture.cause())&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1400" y="2690" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Q0W_JhSwJ4xSzp8v3iTC-11" value="N" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;endArrow=none;" parent="1" source="Q0W_JhSwJ4xSzp8v3iTC-5" target="Q0W_JhSwJ4xSzp8v3iTC-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1360" y="2710" as="sourcePoint" />
            <mxPoint x="1500" y="2820" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="H4OvdQoWyoAmilvTNFpG-1" target="1IMWfKVCYPNeZjfGsvOy-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="H4OvdQoWyoAmilvTNFpG-1" value="&lt;font&gt;pipeline.bind(localAddress, promise);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1660" y="2748.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="1IMWfKVCYPNeZjfGsvOy-1" target="1IMWfKVCYPNeZjfGsvOy-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-1" value="&lt;font&gt;tail.bind(localAddress, promise)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1420" y="2829.5" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;" parent="1" source="1IMWfKVCYPNeZjfGsvOy-3" target="1IMWfKVCYPNeZjfGsvOy-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-3" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;AbstractChannelHandlerContext next = findContextOutbound(MASK_BIND)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1640" y="2829.5" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;" parent="1" source="1IMWfKVCYPNeZjfGsvOy-5" target="1IMWfKVCYPNeZjfGsvOy-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-5" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;EventExecutor executor = next.executor()&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1640" y="2892" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;" parent="1" source="1IMWfKVCYPNeZjfGsvOy-7" target="1IMWfKVCYPNeZjfGsvOy-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-7" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;next.invokeBind(localAddress, promise)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1640" y="2951" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;" parent="1" source="1IMWfKVCYPNeZjfGsvOy-9" target="1IMWfKVCYPNeZjfGsvOy-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-9" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;((ChannelOutboundHandler) handler()).bind(this, localAddress, promise)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="2951" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="1IMWfKVCYPNeZjfGsvOy-11" target="1IMWfKVCYPNeZjfGsvOy-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-11" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;doBind(localAddress)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1430" y="3040" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;curved=1;" parent="1" source="1IMWfKVCYPNeZjfGsvOy-13" target="1IMWfKVCYPNeZjfGsvOy-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="1IMWfKVCYPNeZjfGsvOy-13" target="n1ujcnIcw7S-2mcdyPi6-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-13" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;javaChannel().bind(localAddress, config.getBacklog())&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1640" y="3040" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-20" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;" parent="1" source="1IMWfKVCYPNeZjfGsvOy-15" target="1IMWfKVCYPNeZjfGsvOy-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-15" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;InetSocketAddress isa =&amp;nbsp;Net.checkAddress(local);&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1860" y="3040" width="180" height="39" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-21" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;" parent="1" source="1IMWfKVCYPNeZjfGsvOy-17" target="1IMWfKVCYPNeZjfGsvOy-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-17" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;Net.bind(fd, isa.getAddress(), isa.getPort())&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1860" y="3101" width="180" height="39" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-18" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;Net.listen(fd, backlog &amp;lt; 1 ? 50 : backlog)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1860" y="3159" width="180" height="39" as="geometry" />
        </mxCell>
        <mxCell id="1IMWfKVCYPNeZjfGsvOy-25" value="&lt;font&gt;&lt;div style=&quot;text-align: left&quot;&gt;finally:&lt;/div&gt;&lt;div&gt;workerGroup.shutdownGracefully();&lt;/div&gt;&lt;div&gt;bossGroup.shutdownGracefully();&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="20" y="2758.5" width="200" height="39" as="geometry" />
        </mxCell>
        <mxCell id="v9iovkMEOWd9lAaEUpA6-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=-0.004;exitY=0.197;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;curved=1;exitPerimeter=0;" parent="1" source="n0XTbSt1qkMDTzajxwat-15" target="HtaHdFhjI1Y0VL2FBTaY-75" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-1120" y="1194" />
              <mxPoint x="-1120" y="1119" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="v9iovkMEOWd9lAaEUpA6-2" value="&lt;h1 style=&quot;font-size: 10px&quot;&gt;&lt;span style=&quot;font-size: 10px ; font-weight: 400&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/h1&gt;&lt;h1 style=&quot;font-size: 10px&quot;&gt;&lt;span style=&quot;font-size: 10px ; font-weight: 400&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;关键点：&lt;/font&gt;&lt;/span&gt;&lt;/h1&gt;&lt;ul style=&quot;font-size: 10px&quot;&gt;&lt;li style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;NioEventLoopGroup 是NioEventLoop的数组集合&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;NioEventLoop实现EventExecutor接口，其内部的Executor只是ThreadPerTaskExecutor的代理（活还是ThreadPerTaskExecutor干），说是任务更合适，任务执行前在线程本地记录了当前NioEventLoop实例执行完成后清除，任务取自taskQueue。&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;bossGroup和workGroup分别创建了1个线程池&lt;/font&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;font-size: 10px&quot;&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="-520" y="19" width="520" height="161" as="geometry" />
        </mxCell>
        <mxCell id="v9iovkMEOWd9lAaEUpA6-3" value="这个是真正干活的线程池" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1200" y="600" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-1" value="代码调用很深，但是主要就是Net.bind()和Net.listen()&lt;br&gt;然后就可以监听连接事件了" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="935" y="2671" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-2" value="&lt;font color=&quot;#007fff&quot;&gt;DefaultChannelPipeline&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#0000FF;" parent="1" vertex="1">
          <mxGeometry x="2560" y="1185" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="DHawYOpzunJhD3Rds1HB-3" target="n0XTbSt1qkMDTzajxwat-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-3" value="&lt;font&gt;&lt;b&gt;currentChildHandler&lt;/b&gt; = childHandler&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1200" y="1511.5" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-10" value="&lt;div&gt;ChannelHandler注册流程真是曲折：&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;１）先新建ChannelInitializer封装成DefaultChannelHandlerContext加入pipeline末尾（tail节点前），提交Handler注册任务Ａ到 pendingHandlerCallbackHead 链表（后面register阶段才会启动执行）&lt;/div&gt;&lt;div&gt;２）bind阶段，事件循环线程T启动后第一个任务执行register0(), 会扫描pendingHandlerCallbackHead并执行Handler注册任务，上面A任务会执行，A任务会再向事件循环线程池注册一个异步任务B, 用于执行用户定制的ChannelInitializer并封装ServerBootstrapAcceptor再添加到pipeline末尾, A任务执行完成会将前面默认创建的ChannelInitializer从pipeline删除掉&lt;/div&gt;&lt;div&gt;３）事件循环线程T的下一个循环，会扫描taskQueue读取任务B并执行，将ServerBootstrapAcceptor封装成DefaultChannelHandlerContext加入pipeline末尾&lt;/div&gt;&lt;div&gt;最终服务端启动阶段完成后&lt;b&gt;用于接收连接的Channel&lt;/b&gt;（类NioServerSocketChannel, Acceptor）的Handler pipeline:&lt;br&gt;&lt;b&gt;HeadContext &amp;lt;---&amp;gt;&amp;nbsp;ServerBootstrapAcceptor &amp;lt;---&amp;gt; TailContext&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;NioServerSocketChannel 是用于监听连接的Channel (本质是Server Socket 文件)&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4)&amp;nbsp;至于建立连接后&lt;b&gt;用于通信的 Channel的 Handler pipeline&lt;/b&gt; 是在processSelectedKeys()&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;接受到连接事件后，调用&lt;/span&gt;ServerBootstrapAcceptor&lt;span style=&quot;background-color: initial;&quot;&gt;#channelRead() 执行子Channel Handler的注册的&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1100" y="1670.5" width="320" height="289.5" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=11;fontColor=#007FFF;strokeColor=#000000;curved=1;" parent="1" source="DHawYOpzunJhD3Rds1HB-12" target="n0XTbSt1qkMDTzajxwat-83" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3120" y="3009" />
              <mxPoint x="2760" y="3009" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-12" value="&lt;font&gt;for:&lt;br&gt;&lt;b&gt;selector.select(timeoutMilliis)&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2920" y="2900" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-19" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="DHawYOpzunJhD3Rds1HB-16" target="DHawYOpzunJhD3Rds1HB-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-16" value="&lt;font&gt;hasTasks = hasTasks()&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;判断taskQueue中是否有任务&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2417.5" y="2660.5" width="125" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-20" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="DHawYOpzunJhD3Rds1HB-18" target="n0XTbSt1qkMDTzajxwat-73" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2480" y="2858.5" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-24" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="DHawYOpzunJhD3Rds1HB-18" target="DHawYOpzunJhD3Rds1HB-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-18" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;hasTasks ? selectSupplier.get() : SelectStrategy.SELECT&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2417.5" y="2718.5" width="125" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DHawYOpzunJhD3Rds1HB-23" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;return selector.selectNow()&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;返回当前就绪事件个数，没有就绪事件返回０&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2680" y="2718.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-1" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;从pipeline Head开始依次触发执行每个节点的&lt;b&gt;channelRegistered&lt;/b&gt;()方法&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2160" y="2399.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;dashed=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-5" target="n1ujcnIcw7S-2mcdyPi6-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-5" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;bind成功之后，invokeLater(...)&amp;nbsp;&lt;br&gt;&lt;/span&gt;提交了一个新任务&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1640" y="3210" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-7" value="&lt;font style=&quot;font-size: 10px&quot;&gt;pipeline.&lt;b&gt;fireChannelActive&lt;/b&gt;()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;从head开始依次执行每个节点的channelActive&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1860" y="3210" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-9" value="线程名类似：nioEventLoopGroup-2-1" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2040" y="2660.5" width="190" height="20" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-14" value="服务端启动成功后状态：&lt;br&gt;main线程：阻塞等待closeFuture回调；&lt;br&gt;端口绑定的channel的pipeline：&amp;nbsp;HeadContext &amp;lt;---&amp;gt; ServerBootstrapAcceptor &amp;lt;---&amp;gt; TailContext；&lt;br&gt;register阶段启动的线程(名称类似：nioEventLoopGroup-2-1): 一直在循环，监听Selector事件。" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="160" y="2641" width="480" height="79" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-15" value="可以在这个switch处添加断点监控客户端请求连接后的处理" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="2320" y="2871.5" width="100" height="33" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;curved=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-21" target="n1ujcnIcw7S-2mcdyPi6-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-20" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-21" target="n1ujcnIcw7S-2mcdyPi6-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-21" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;Bootstrap bootstrap = new &lt;b&gt;Bootstrap&lt;/b&gt;()&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="3160" y="400" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-23" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;curved=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-24" target="n1ujcnIcw7S-2mcdyPi6-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-24" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;.group(workerGroup)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(0 , 127 , 255) ; font-size: 10px&quot;&gt;给group赋值&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3400" y="520" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-25" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;div&gt;private final Map&amp;lt;&lt;b&gt;ChannelOption&lt;/b&gt;&amp;lt;?&amp;gt;, Object&amp;gt; options = new LinkedHashMap&amp;lt;ChannelOption&amp;lt;?&amp;gt;, Object&amp;gt;();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; private final Map&amp;lt;&lt;b&gt;AttributeKey&lt;/b&gt;&amp;lt;?&amp;gt;, Object&amp;gt; attrs = new LinkedHashMap&amp;lt;AttributeKey&amp;lt;?&amp;gt;, Object&amp;gt;();&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3360" y="390" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-27" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-28" target="n1ujcnIcw7S-2mcdyPi6-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-28" value="&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;.channel(&lt;b&gt;NioSocketChannel&lt;/b&gt;.class)&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;给channelFactory赋值&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3380" y="580" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-30" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#007FFF;strokeColor=#000000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-31" target="n1ujcnIcw7S-2mcdyPi6-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-31" value="&lt;font&gt;&lt;div&gt;&lt;/div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;.option(ChannelOption.AUTO_READ, true)&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;给options Map赋值&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3380" y="640" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-32" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-33" target="n1ujcnIcw7S-2mcdyPi6-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-33" target="n1ujcnIcw7S-2mcdyPi6-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-33" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;bootstrap.xxx()&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;对象字段初始化&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="3160" y="520" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-78" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#007FFF;dashed=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-35" target="n1ujcnIcw7S-2mcdyPi6-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-35" value="&lt;font&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;/div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;.handler(new &lt;b&gt;MyChannelInitializer&lt;/b&gt;())&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;给&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;handler赋值&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;ChannelInitializer，用于创建后面的ChannelPipeline时往链表插入ChannelHandler节点&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3380" y="710" width="200" height="70" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-36" target="n1ujcnIcw7S-2mcdyPi6-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-36" target="n1ujcnIcw7S-2mcdyPi6-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-36" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;ChannelFuture f = bootstrap.&lt;b&gt;connect&lt;/b&gt;(inetHost, inetPort)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="3140" y="840" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-38" target="n1ujcnIcw7S-2mcdyPi6-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-113" value="同步等待promise回调" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#007FFF;dashed=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-38" target="n1ujcnIcw7S-2mcdyPi6-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-38" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;f.sync()&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="3160" y="1220" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-40" target="n1ujcnIcw7S-2mcdyPi6-42" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-40" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;f.channel().closeFuture().sync()&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="3160" y="1300" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-42" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;finally:&lt;br&gt;f.channel().closeFuture().sync()&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="3160" y="1380" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-44" target="n1ujcnIcw7S-2mcdyPi6-46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-44" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;connect(new InetSocketAddress(&lt;br&gt;inetHost, inetPort))&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3380" y="840" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-46" target="n1ujcnIcw7S-2mcdyPi6-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-46" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;doResolveAndConnect(&lt;br&gt;remoteAddress, config.localAddress())&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3580" y="830" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-57" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-48" target="n1ujcnIcw7S-2mcdyPi6-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-63" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-48" target="n1ujcnIcw7S-2mcdyPi6-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-48" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;regFuture = initAndRegister()&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;和服务端大部分一致&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="3780" y="840" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-58" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-50" target="n1ujcnIcw7S-2mcdyPi6-51" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-50" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;channel = regFuture.channel()&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3780" y="1160" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-59" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-51" target="n1ujcnIcw7S-2mcdyPi6-52" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-51" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;promise = new PendingRegistrationPromise(channel)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3760" y="1220" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-54" value="失败回调" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;curved=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-52" target="n1ujcnIcw7S-2mcdyPi6-53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-56" value="成功回调" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-52" target="n1ujcnIcw7S-2mcdyPi6-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-117" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-52" target="n1ujcnIcw7S-2mcdyPi6-116" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-52" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;regFuture.addListener(new ChannelFutureListener() {...&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;})&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3780" y="1280" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-53" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;promise.setFailure(cause)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4000" y="1240" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-61" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-55" target="n1ujcnIcw7S-2mcdyPi6-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-55" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;promise.registered()&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4000" y="1320" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-93" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#330000;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-60" target="n1ujcnIcw7S-2mcdyPi6-92" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-60" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;doResolveAndConnect0(channel, remoteAddress, localAddress, promise)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="4000" y="1400" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-66" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-62" target="n1ujcnIcw7S-2mcdyPi6-64" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-69" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-62" target="n1ujcnIcw7S-2mcdyPi6-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-62" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;channel = channelFactory.newChannel()&lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;&lt;span&gt;和服务端基本一致，反射通过EpollSelectorProvider&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;创建&lt;b&gt;NioSocketChannel&lt;/b&gt; (指明要监听&lt;b&gt;OP_READ&lt;/b&gt;事件、要设置非阻塞模式)、初始化pipeline&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;&lt;span&gt;&lt;b&gt;1 客户端SocketChannel创建&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="4000" y="825" width="200" height="70" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-67" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-64" target="n1ujcnIcw7S-2mcdyPi6-65" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4099.999999999999" y="960" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-72" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-64" target="n1ujcnIcw7S-2mcdyPi6-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-80" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontSize=8;fontColor=#007FFF;strokeColor=#007FFF;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-64" target="n1ujcnIcw7S-2mcdyPi6-79" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-81" value="往 NioEventLoop&lt;br&gt;taskQueue提交任务" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#007FFF;" parent="n1ujcnIcw7S-2mcdyPi6-80" vertex="1" connectable="0">
          <mxGeometry x="0.2667" y="-2" relative="1" as="geometry">
            <mxPoint y="31" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-64" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;init(channel)&lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;主要是初始化ChannelHandler的pipeline(添加用户自定义ChannelHandler这里是&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 8px ; color: rgb(0 , 127 , 255)&quot;&gt;MyChannelInitializer&lt;/span&gt;&lt;span style=&quot;font-size: 8px ; color: rgb(0 , 127 , 255)&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;&lt;b&gt;2 Channel对象属性初始化&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="4000" y="920" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-90" value="触发执行" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#007FFF;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-65" target="n1ujcnIcw7S-2mcdyPi6-79" edge="1">
          <mxGeometry x="-0.0909" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-123" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;curved=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-65" target="n1ujcnIcw7S-2mcdyPi6-122" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-65" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;regFuture = config().group().&lt;b&gt;register&lt;/b&gt;(channel)&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;跟服务端一样，Channel与Selector绑定、往pipeline注册ChannelHandler节点、依次执行各节点&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;channelRegistered()、&lt;b&gt;启动EventLoop线程&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="4000" y="1145" width="200" height="70" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-68" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;provider.openSocketChannel()&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="4240" y="840" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-70" value="这里和服务端有点不一样，&lt;br&gt;没有额外封装一层，而是直接加入到pipeline" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="4015" y="980" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-75" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-71" target="n1ujcnIcw7S-2mcdyPi6-73" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-71" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;div&gt;ChannelPipeline p = channel.pipeline();&lt;/div&gt;&lt;div&gt;&lt;b&gt;p.addLast(config.handler())&lt;/b&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4250" y="930" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-77" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-73" target="n1ujcnIcw7S-2mcdyPi6-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-73" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;span&gt;Map&amp;lt;ChannelOption&amp;lt;?&amp;gt;, Object&amp;gt; options = options0();&lt;/span&gt;&lt;br&gt;&lt;span&gt;setChannelOptions(channel, options, logger)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4240" y="990" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-76" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;div&gt;Map&amp;lt;AttributeKey&amp;lt;?&amp;gt;, Object&amp;gt; attrs = attrs0();&lt;/div&gt;&lt;div&gt;for:&lt;/div&gt;&lt;div&gt;channel.attr((AttributeKey&amp;lt;Object&amp;gt;) e.getKey()).set(e.getValue());&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4240" y="1050" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-86" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-79" target="n1ujcnIcw7S-2mcdyPi6-82" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-79" value="&lt;font&gt;initChannel(final Channel ch)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;这里和服务端不太一样&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="4260" y="1110" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-87" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-82" target="n1ujcnIcw7S-2mcdyPi6-83" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-82" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;channel.pipeline().addLast(new LineBasedFrameDecoder(1024))&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4480" y="1110" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-88" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-83" target="n1ujcnIcw7S-2mcdyPi6-84" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-83" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;channel.pipeline().addLast(new StringDecoder(StandardCharsets.UTF_8))&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4470" y="1170" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-89" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-84" target="n1ujcnIcw7S-2mcdyPi6-85" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-84" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;channel.pipeline().addLast(new StringEncoder(StandardCharsets.UTF_8))&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4470" y="1231" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-85" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;channel.pipeline().addLast(new NettyClientHandler())&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4480" y="1290" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-91" value="MyChannelInitializer 也是临时用于注册其他ChannelHandler的，在注册完成后会被从pipeline删除。&lt;br&gt;initChannel() 执行完毕后：&lt;br&gt;HeadContext&amp;nbsp; &amp;lt;---&amp;gt;&amp;nbsp;LineBasedFrameDecoder &amp;lt;---&amp;gt;&amp;nbsp;StringDecoder &amp;lt;---&amp;gt;&amp;nbsp;StringEncoder &amp;lt;---&amp;gt; NettyClientHandler &amp;lt;---&amp;gt; TailContext" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="4240" y="1341" width="610" height="59" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-95" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#330000;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-92" target="n1ujcnIcw7S-2mcdyPi6-94" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-92" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;doConnect(resolveFuture.getNow(), localAddress, promise)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4200" y="1405" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-97" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#330000;strokeColor=#330000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-94" target="n1ujcnIcw7S-2mcdyPi6-96" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4620" y="1425" />
              <mxPoint x="4620" y="1465" />
              <mxPoint x="4060" y="1465" />
              <mxPoint x="4060" y="1500" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-94" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;channel = connectPromise.channel()&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4440" y="1405" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-99" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#330000;strokeColor=#330000;dashed=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-96" target="n1ujcnIcw7S-2mcdyPi6-98" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-124" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#007FFF;strokeWidth=1;dashed=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-96" target="n1ujcnIcw7S-2mcdyPi6-122" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4180" y="1480" />
              <mxPoint x="4180" y="1260" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-126" value="提交任务" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#007FFF;" parent="n1ujcnIcw7S-2mcdyPi6-124" vertex="1" connectable="0">
          <mxGeometry x="0.0667" y="-18" relative="1" as="geometry">
            <mxPoint x="-8" y="-9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-96" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;channel.eventLoop().execute(...)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4080" y="1480" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-101" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#330000;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-98" target="n1ujcnIcw7S-2mcdyPi6-100" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-98" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;channel.connect(remoteAddress, connectPromise)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4280" y="1480" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-103" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-100" target="n1ujcnIcw7S-2mcdyPi6-102" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4660" y="1500" />
              <mxPoint x="4660" y="1550" />
              <mxPoint x="4060" y="1550" />
              <mxPoint x="4060" y="1580" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-100" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;tail.connect(remoteAddress, promise)&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;从尾部开始查OutboundHandler执行connect()方法&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4480" y="1470" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-106" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-102" target="n1ujcnIcw7S-2mcdyPi6-104" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-102" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;doConnect(remoteAddress, localAddress)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4080" y="1560" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-107" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-104" target="n1ujcnIcw7S-2mcdyPi6-105" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-104" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;connected = SocketUtils.connect(javaChannel(), remoteAddress)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="4280" y="1560" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-105" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;selectionKey().interestOps(&lt;br&gt;SelectionKey.&lt;b&gt;OP_CONNECT&lt;/b&gt;)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="4280" y="1620.75" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-110" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-108" target="n1ujcnIcw7S-2mcdyPi6-109" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-108" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;fulfillConnectPromise(promise, wasActive)&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;等待连接完成会调到这里&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="4280" y="1680.25" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-112" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-109" target="n1ujcnIcw7S-2mcdyPi6-111" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-115" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;dashed=1;fontSize=8;fontColor=#007FFF;strokeColor=#007FFF;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-109" target="n1ujcnIcw7S-2mcdyPi6-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4480" y="1730" />
              <mxPoint x="3700" y="1730" />
              <mxPoint x="3700" y="1250" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-109" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;promise.trySuccess()&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="4480" y="1680.25" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-111" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;pipeline().fireChannelActive()&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="4480" y="1740" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-116" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;return regFuture;&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3780" y="1340" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-122" value="&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;b&gt;NioEventLoop#run()&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;同服务端一样也启动了Loop线程&lt;br&gt;&lt;/font&gt;1）register阶段：处理pipeline初始化；&lt;br&gt;2）doConnect阶段，连接服务端&lt;br&gt;3）监听事件（连接建立、可读）并处理&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fa6800;strokeColor=#C73500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="4240" y="1200" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-130" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-128" target="n1ujcnIcw7S-2mcdyPi6-129" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-128" value="&lt;font&gt;&lt;span style=&quot;font-size: 11px&quot;&gt;&lt;b&gt;processSelectedKeys()&lt;br&gt;&lt;/b&gt;&lt;/span&gt;监听事件&amp;amp;处理逻辑&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;strokeColor=#B09500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="3320" y="2280.5" width="160" height="39" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-135" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-129" target="n1ujcnIcw7S-2mcdyPi6-134" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-129" value="&lt;font&gt;processSelectedKeysOptimized()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3520" y="2279.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-131" value="sun.nio.ch.SelectionKeyImpl (触发事件对象)" style="swimlane;startSize=20;" parent="1" vertex="1">
          <mxGeometry x="-1600" y="100" width="480" height="220" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-132" value="&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//监听的Channel（netty中本质就是socket fd）&lt;/font&gt;&lt;br&gt;&lt;b&gt;channel&lt;/b&gt; = {ServerSocketChannelImpl@1643} &quot;sun.nio.ch.ServerSocketChannelImpl[/0:0:0:0:0:0:0:0:6666]&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//多路复用器&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;selector&lt;/b&gt; = {EPollSelectorImpl@1585}&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;index = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//关注的事件，16是OP_ACCEPT事件&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;interestOps&lt;/b&gt; = 16&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//触发的事件&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;readyOps&lt;/b&gt; = 16&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;valid = true&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;//绑定的IP、端口信息&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;attachment = {NioServerSocketChannel@1190} &quot;[id: 0xdd365b37, L:/0:0:0:0:0:0:0:0:6666]&quot;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="n1ujcnIcw7S-2mcdyPi6-131" vertex="1">
          <mxGeometry y="20" width="480" height="200" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-133" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.144;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;exitPerimeter=0;" parent="1" source="HtaHdFhjI1Y0VL2FBTaY-36" target="n1ujcnIcw7S-2mcdyPi6-131" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-1100" y="198" />
              <mxPoint x="-1100" y="100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-138" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-134" target="n1ujcnIcw7S-2mcdyPi6-137" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-134" value="&lt;font&gt;for：&lt;br&gt;SelectionKey k = selectedKeys.keys[i];&lt;br&gt;processSelectedKey(k, (AbstractNioChannel) a);&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3760" y="2270" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-140" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#330000;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-137" target="n1ujcnIcw7S-2mcdyPi6-139" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4300" y="2300.5" />
              <mxPoint x="4300" y="2350.5" />
              <mxPoint x="3550" y="2350.5" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-137" value="&lt;font&gt;readyOps = k.readyOps()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4080" y="2280.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-144" value="OP_CONNECT&lt;br&gt;客户端发送连接事件" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#330000;strokeColor=#330000;strokeWidth=1;curved=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-139" target="n1ujcnIcw7S-2mcdyPi6-141" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3620" y="2640" />
              <mxPoint x="3620" y="2421" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-145" value="OP_WRITE&lt;br&gt;写事件" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#330000;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-139" target="n1ujcnIcw7S-2mcdyPi6-142" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-146" value="OP_READ |&amp;nbsp;OP_ACCEPT&amp;nbsp;&lt;br&gt;服务端接受连接事件&lt;br&gt;读事件" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#330000;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-139" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3681" y="2760" as="targetPoint" />
            <Array as="points">
              <mxPoint x="3641" y="2640" />
              <mxPoint x="3641" y="2760" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-139" value="&lt;font color=&quot;#330000&quot;&gt;readyOps&lt;br&gt;就绪的事件类型&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;rounded=1;arcSize=11;" parent="1" vertex="1">
          <mxGeometry x="3511" y="2600" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-210" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=11;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-141" target="n1ujcnIcw7S-2mcdyPi6-209" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-141" value="&lt;font&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;int ops = k.interestOps();&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;ops &amp;amp;= ~SelectionKey.OP_CONNECT;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;k.interestOps(ops)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;unsafe.&lt;b&gt;finishConnect&lt;/b&gt;()&lt;/span&gt;&lt;/div&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;先删除监听OP_CONNECT事件，然后处理连接就绪事件&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3680" y="2380.5" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-142" value="&lt;font&gt;&amp;nbsp;ch.unsafe().forceFlush()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3681" y="2620" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-148" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-143" target="n1ujcnIcw7S-2mcdyPi6-147" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3881" y="2760" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-143" value="&lt;font&gt;unsafe.read()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3681" y="2740" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-153" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-147" target="n1ujcnIcw7S-2mcdyPi6-149" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-147" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;div&gt;ChannelConfig config = config();&lt;/div&gt;&lt;div&gt;ChannelPipeline pipeline = pipeline();&lt;/div&gt;&lt;div&gt;RecvByteBufAllocator.Handle allocHandle = unsafe().recvBufAllocHandle();&lt;/div&gt;&lt;div&gt;allocHandle.reset(config);&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3921" y="2730.5" width="200" height="59" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-151" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-149" target="n1ujcnIcw7S-2mcdyPi6-150" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-160" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-149" target="n1ujcnIcw7S-2mcdyPi6-159" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-149" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;while：&lt;br&gt;localRead = doReadMessages(readBuf)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3921" y="2820" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-155" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-150" target="n1ujcnIcw7S-2mcdyPi6-154" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-157" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-150" target="n1ujcnIcw7S-2mcdyPi6-156" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-150" value="&lt;font&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;ch = SocketUtils.accept(javaChannel())&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;返回一个与客户端连接的channel （SocketChannel, 用于通信的Socket文件）&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="4201" y="2819.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-152" value="AbstractNioMesssageChannel$NioMessageUnsafe" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="3681" y="2720" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-154" value="&lt;font&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;readBuf.add(new &lt;b&gt;NioSocketChannel&lt;/b&gt;(this, ch))&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;这里buf只是个List列表, new NioSocketChannel时会创建ChannelPipeline&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="4191" y="2879.5" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-206" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;dashed=1;fontSize=11;fontColor=#007FFF;strokeColor=#FF3333;strokeWidth=2;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-156" target="n1ujcnIcw7S-2mcdyPi6-198" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4140" y="2220" as="targetPoint" />
            <Array as="points">
              <mxPoint x="4580" y="2840" />
              <mxPoint x="4580" y="2210" />
              <mxPoint x="3510" y="2210" />
              <mxPoint x="3510" y="2110" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-207" value="&lt;div&gt;4 触发客户端&lt;/div&gt;&lt;div&gt;OP_CONNECT事件&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontColor=#007FFF;" parent="n1ujcnIcw7S-2mcdyPi6-206" vertex="1" connectable="0">
          <mxGeometry x="0.5892" relative="1" as="geometry">
            <mxPoint x="-120" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-156" value="&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;serverSocketChannel.accept()&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot; color=&quot;#007fff&quot;&gt;接受连接请求&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="4401" y="2819.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-158" value="Java Nio" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="4456" y="2799.5" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-163" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-159" target="n1ujcnIcw7S-2mcdyPi6-162" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-172" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-159" target="n1ujcnIcw7S-2mcdyPi6-171" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-159" value="&lt;font&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;for：&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;pipeline.&lt;b&gt;fireChannelRead&lt;/b&gt;(readBuf.get(i))&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;遍历请求连接的NioSocketChannel列表,&lt;br&gt;&lt;/font&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;从服务端pipeline 头节点开始依次对客户端Channel执行ChannelRead()&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3921" y="2930" width="200" height="70" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-161" value="这里的pipeline是服务端pipeline" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="4121" y="2750" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-165" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-162" target="n1ujcnIcw7S-2mcdyPi6-164" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-162" value="&lt;font&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;pipeline.&lt;b&gt;fireChannelReadComplete&lt;/b&gt;()&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3921" y="3140" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-167" value="Y" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-164" target="n1ujcnIcw7S-2mcdyPi6-166" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-169" value="N" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-164" target="n1ujcnIcw7S-2mcdyPi6-168" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-164" value="exception != null" style="rhombus;whiteSpace=wrap;html=1;rounded=1;fontSize=10;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="3967" y="3200" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-170" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-166" target="n1ujcnIcw7S-2mcdyPi6-168" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-166" value="&lt;font&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;pipeline.&lt;b&gt;fireExceptionCaught&lt;/b&gt;(exception)&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4147" y="3200" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-168" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;finally:&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;removeReadOp()&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3917" y="3280" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-180" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-171" target="n1ujcnIcw7S-2mcdyPi6-173" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-171" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;HeadContex&lt;/b&gt;#channelRead()&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;HeadContext的channelRead()没有额外处理直接传给下一个ChannelHandler执行&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="4201" y="2945" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-182" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-173" target="n1ujcnIcw7S-2mcdyPi6-181" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-185" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-173" target="n1ujcnIcw7S-2mcdyPi6-184" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-173" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;ServerBootstrapAcceptor&lt;br&gt;&lt;/b&gt;#channelRead()&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;这个channelRead()做的却是initAndRegister&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="4201" y="3015" width="160" height="53.5" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-175" value="&lt;div&gt;NioServerSocketChannel的pipeline：&lt;/div&gt;&lt;div&gt;HeadContext &amp;lt;---&amp;gt; ServerBootstrapAcceptor &amp;lt;---&amp;gt; TailContext&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="3681" y="2950" width="240" height="30" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-178" value="&lt;b&gt;findContextInbound&lt;/b&gt;(MASK_CHANNEL_READ)&lt;br&gt;查找pipeline下一个入站ChannelHandler节点" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="4281" y="2990" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-181" value="&lt;font&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;HeadContex&lt;/b&gt;#channelRead()&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="4201" y="3100" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-187" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-184" target="n1ujcnIcw7S-2mcdyPi6-186" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-184" value="&lt;font style=&quot;font-size: 9px&quot;&gt;&lt;b&gt;&lt;span&gt;这里的逻辑和前面的initAndRegister()逻辑类似，&lt;/span&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;除了客户端Channel是从doReadMessages中拿到的&lt;/font&gt;&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" parent="1" vertex="1">
          <mxGeometry x="4401" y="3015" width="160" height="53.5" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-189" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-186" target="n1ujcnIcw7S-2mcdyPi6-188" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-186" value="&lt;font style=&quot;font-size: 8px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;child.pipeline().addLast(childHandler)&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;这里的childHandler是用户定制的ChannelInitializer，如：&lt;/font&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;&lt;span&gt;MyChannelInitializer&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4601" y="3017.5" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-193" style="edgeStyle=entityRelationEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-188" target="n1ujcnIcw7S-2mcdyPi6-192" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-188" value="&lt;font&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;childGroup.register(child).addListener(...)&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4601" y="3080" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-190" value="&lt;font style=&quot;font-size: 10px&quot;&gt;这里同样是异步实现客户端Channel pipeline的后置处理的&lt;br&gt;在workGroup的NioEventLoop线程启动后执行定制的ChannelInitializer的initChannel() 方法&lt;br&gt;最终客户端Channel的pipeline：（以测试DEMO为例）&lt;br&gt;&lt;br&gt;&lt;b&gt;HeadContext &amp;lt;---&amp;gt; MyEncoder &amp;lt;---&amp;gt; MyDecoder &amp;lt;---&amp;gt; NettyServerHandler&amp;nbsp; &amp;lt;---&amp;gt; TailContext&lt;/b&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="4601" y="2943.5" width="460" height="60" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-201" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontSize=11;fontColor=#007FFF;strokeColor=#FF3333;strokeWidth=2;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-192" target="n1ujcnIcw7S-2mcdyPi6-197" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-202" value="3" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=11;fontColor=#007FFF;" parent="n1ujcnIcw7S-2mcdyPi6-201" vertex="1" connectable="0">
          <mxGeometry x="0.9356" y="3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-192" value="&lt;font&gt;&lt;b style=&quot;font-size: 11px&quot;&gt;NioEventLoop#run()&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;服务端处理客户端读写事件的Loop线程&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fa6800;strokeColor=#C73500;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="4841" y="3060" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-195" value="&lt;font style=&quot;font-size: 11px&quot;&gt;服务端bossGroup NioEventLoop线程&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;fontColor=#000000;fillColor=#fa6800;strokeColor=#C73500;" parent="1" vertex="1">
          <mxGeometry x="3320" y="1940" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-197" value="&lt;span style=&quot;font-size: 11px&quot;&gt;服务端workerGroup NioEventLoop线程&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;fontColor=#000000;fillColor=#fa6800;strokeColor=#C73500;" parent="1" vertex="1">
          <mxGeometry x="3320" y="2010.5" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-208" value="5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;fontSize=11;fontColor=#007FFF;strokeColor=#FF3333;strokeWidth=2;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-198" target="n1ujcnIcw7S-2mcdyPi6-141" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3400" y="2230" />
              <mxPoint x="3490" y="2230" />
              <mxPoint x="3490" y="2421" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-198" value="&lt;span style=&quot;font-size: 11px&quot;&gt;客户端workerGroup NioEventLoop线程&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=8;fontColor=#000000;fillColor=#fa6800;strokeColor=#C73500;" parent="1" vertex="1">
          <mxGeometry x="3320" y="2080" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-118" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#FF3333;fillColor=#d5e8d4;strokeWidth=2;dashed=1;" parent="1" target="n1ujcnIcw7S-2mcdyPi6-195" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4280" y="1592" as="sourcePoint" />
            <mxPoint x="3120" y="2912" as="targetPoint" />
            <Array as="points">
              <mxPoint x="4280" y="1612" />
              <mxPoint x="3540" y="1612" />
              <mxPoint x="3540" y="1970" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-119" value="&lt;b&gt;1 发起连接&lt;/b&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=8;fontColor=#007FFF;" parent="n1ujcnIcw7S-2mcdyPi6-118" vertex="1" connectable="0">
          <mxGeometry x="-0.8248" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-212" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=11;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-209" target="n1ujcnIcw7S-2mcdyPi6-211" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-209" value="&lt;font&gt;javaChannel().finishConnect()&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3920" y="2400.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-214" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" source="n1ujcnIcw7S-2mcdyPi6-211" target="n1ujcnIcw7S-2mcdyPi6-213" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-216" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;strokeWidth=1;" parent="1" target="n1ujcnIcw7S-2mcdyPi6-215" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="4020" y="2500.5" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-211" value="&lt;font&gt;fulfillConnectPromise(&lt;br&gt;connectPromise, wasActive)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3920" y="2460.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-213" value="&lt;font&gt;pipeline().fireChannelActive()&lt;br&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;依次执行pipeline中的ChannnelHandler节点的channelActive()&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="4160" y="2460" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-215" value="&lt;font&gt;finally:&lt;br&gt;connectTimeoutFuture.cancel(false)&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="3920" y="2520.5" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="n1ujcnIcw7S-2mcdyPi6-217" value="AbstractChannel" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=8;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="1760" y="2180" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="yP6VWiIm5Xh2lBbPG2Jm-2" value="io.netty.bootstrap.ServerBootstrap" style="swimlane;startSize=20;" parent="1" vertex="1">
          <mxGeometry x="-520" y="820" width="480" height="260" as="geometry" />
        </mxCell>
        <mxCell id="yP6VWiIm5Xh2lBbPG2Jm-3" value="&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;childOptions = {LinkedHashMap@788}&amp;nbsp; size = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;childAttrs = {LinkedHashMap@789}&amp;nbsp; size = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;//&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;config&lt;/b&gt; = {ServerBootstrapConfig@792} &quot;ServerBootstrapConfig()&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;childHandler&lt;/b&gt; = null&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font style=&quot;color: rgb(0 , 127 , 255) ; font-size: 8px&quot;&gt;//负责处理业务事件的多路复用器及线程池组（每组包含一个多路复用器＋一个线程池&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 127 , 255) ; font-size: 8px&quot;&gt;）&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;childGroup&lt;/b&gt;&amp;nbsp;= null&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;color: rgb(0 , 127 , 255) ; font-size: 8px&quot;&gt;//负责处理连接事件的多路复用器及线程池组（每组包含一个多路复用器＋一个线程池&lt;/font&gt;&lt;span style=&quot;color: rgb(0 , 127 , 255) ; font-size: 8px&quot;&gt;）&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;group&lt;/b&gt; = null&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&#x9;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;span style=&quot;color: rgb(0 , 127 , 255)&quot;&gt;//创建Channel的工厂，测试中是ReflectivechannelFactory(NioServerSocketChannel.class)&lt;/span&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;b style=&quot;font-size: 10px&quot;&gt;channelFactory&lt;/b&gt;&lt;span style=&quot;font-size: 10px&quot;&gt; = null&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;//服务端IP:Port&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;localAddress&lt;/b&gt; = null&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;span&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;&lt;b&gt;options&lt;/b&gt; = {LinkedHashMap@786}&amp;nbsp; size = 0&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;attrs = {LinkedHashMap@787}&amp;nbsp; size = 0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10px&quot;&gt;handler = null&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="yP6VWiIm5Xh2lBbPG2Jm-2" vertex="1">
          <mxGeometry y="20" width="480" height="240" as="geometry" />
        </mxCell>
        <mxCell id="yP6VWiIm5Xh2lBbPG2Jm-4" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;io.netty.bootstrap.&lt;b&gt;AbstractBootstrap&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;服务器抽象实现类&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;volatile EventLoopGroup group;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;private volatile ChannelFactory&amp;lt;? extends C&amp;gt; channelFactory;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;private volatile SocketAddress localAddress;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;//Channel配置选项，比如Socket选项等&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;private final Map&amp;lt;ChannelOption&amp;lt;?&amp;gt;, Object&amp;gt; options =&amp;nbsp;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;new ConcurrentHashMap&amp;lt;ChannelOption&amp;lt;?&amp;gt;, Object&amp;gt;();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;private final Map&amp;lt;AttributeKey&amp;lt;?&amp;gt;, Object&amp;gt; attrs = new ConcurrentHashMap&amp;lt;AttributeKey&amp;lt;?&amp;gt;, Object&amp;gt;();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;private volatile ChannelHandler handler;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-520" y="560" width="480" height="220" as="geometry" />
        </mxCell>
        <mxCell id="SU1bIEB32mpXXK62h1h6-5" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;后面的任务是监听连接请求与处理&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="3110" y="3250" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="SU1bIEB32mpXXK62h1h6-6" value="&lt;font color=&quot;#007fff&quot;&gt;测试案例这里会循环执行两次&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2650" y="2285.5" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="SU1bIEB32mpXXK62h1h6-7" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;ServerBootstrapAcceptor&lt;br&gt;#handlerAdded()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;实现为空&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1740" y="1750" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="PHfMGQpCaa9Q0VLSc77i-1" value="&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;if (isShuttingDown())&lt;br&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;closeAll();&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px;&quot;&gt;遍历channels Map 执行close&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2417.5" y="3040" width="125" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="1Bj1PAyk8Sx6_N2pJUJ7" name="ByteBuf实现原理">
    <mxGraphModel dx="2267" dy="689" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="oKPWLzEbPb163pztiOSI-0" />
        <mxCell id="oKPWLzEbPb163pztiOSI-1" parent="oKPWLzEbPb163pztiOSI-0" />
        <mxCell id="OfD6Csn-yZZ42Vhgxint-35" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-24" target="OfD6Csn-yZZ42Vhgxint-32" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="940" y="320" />
              <mxPoint x="940" y="460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-0" value="&lt;h1&gt;Netty ByteBuf 工作原理（4.1.35）&lt;/h1&gt;&lt;p&gt;前置知识：&lt;br&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Netty中创建ByteBuf的方式&lt;font color=&quot;#007fff&quot;&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;（比如服务端NioEventLoop worker接收到读事件[客户端有写数据]，交给对应SocketChannel pipeline处理pipeline.fireChannelRead(byteBuf)之前，会获取RecvByteBufAllocator.Handle默认实例，创建PooledUnsafeDirectByteBuf, 并将数据读入此ByteBuf实例）&lt;/font&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;Netty推荐使用直接缓冲：We should always prefer direct buffers by default if we can use a Cleaner to release direct buffers.&lt;/font&gt;&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font color=&quot;#330000&quot;&gt;位运算定律 参考《Bit Twiddling Hacks》http://graphics.stanford.edu/~seander/bithacks.html 有好多骚操作！&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px&quot;&gt;netty中用了好多位运算取代常规运算（比如：求某个int值的二进制最高位１后中有多少个０；求大于等于某个数的最小２次幂）&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font color=&quot;#330000&quot;&gt;jemalloc Netty内存管理参考jemalloc实现的，了解jemalloc实现有助于理解Netty内存管理的实现源码&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font color=&quot;#330000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="40" y="19" width="760" height="181" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;curved=1;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-1" target="OfD6Csn-yZZ42Vhgxint-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-1" value="start" style="ellipse;whiteSpace=wrap;html=1;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="80" y="320" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-5" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-2" target="OfD6Csn-yZZ42Vhgxint-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-2" value="AbstractNioByteChannel&lt;br style=&quot;font-size: 10px;&quot;&gt;$NioByteUnsafe&lt;br style=&quot;font-size: 10px;&quot;&gt;read()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="40" y="400" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-15" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-4" target="OfD6Csn-yZZ42Vhgxint-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-18" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-4" target="OfD6Csn-yZZ42Vhgxint-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-4" value="&lt;b&gt;ByteBufAllocator&lt;/b&gt; &lt;b&gt;allocator&lt;/b&gt; = config.getAllocator()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="240" y="400" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-9" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-6" target="OfD6Csn-yZZ42Vhgxint-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-6" value="allocHandle.reset(config)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="280" y="520" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-11" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-8" target="OfD6Csn-yZZ42Vhgxint-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-37" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-8" target="OfD6Csn-yZZ42Vhgxint-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-8" value="byteBuf = allocHandle.allocate(allocator)&lt;br&gt;&lt;font color=&quot;#ff3333&quot;&gt;看上去是从Chunk中按需要的大小选出一块映射到ByteBuf&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="260" y="580" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-10" value="allocHandle.lastBytesRead(doReadBytes(byteBuf))" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="240" y="640" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-16" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-13" target="OfD6Csn-yZZ42Vhgxint-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-31" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-13" target="OfD6Csn-yZZ42Vhgxint-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-13" value="&lt;b&gt;RecvByteBufAllocator.Handle &lt;br&gt;allocHandle&lt;/b&gt; = recvBufAllocHandle()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="240" y="460" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-17" value="allocator = ByteBufAllocator.DEFAULT" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="520" y="400" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-20" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;dashed=1;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-19" target="OfD6Csn-yZZ42Vhgxint-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-19" value="PooledByteBufAllocator.DEFAULT" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="800" y="400" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-22" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-21" target="OfD6Csn-yZZ42Vhgxint-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-86" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-21" target="OfD6Csn-yZZ42Vhgxint-85" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-21" value="DEFAULT =&amp;nbsp;new &lt;b&gt;PooledByteBufAllocator&lt;/b&gt;(&lt;br&gt;PlatformDependent.directBufferPreferred())&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;是个静态字段，公用的&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="800" y="340" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-23" value="PooledByteBufAllocator" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="855" y="320" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-25" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-24" target="OfD6Csn-yZZ42Vhgxint-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-24" value="&lt;font style=&quot;font-size: 10px&quot;&gt;创建客户端连接NioSocketChannel&lt;br&gt;时初始化&lt;/font&gt;" style="ellipse;whiteSpace=wrap;html=1;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="860" y="280" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-29" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-26" target="OfD6Csn-yZZ42Vhgxint-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-26" value="&lt;font color=&quot;#330000&quot;&gt;new CleanerJava6()&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1080" y="280" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-30" value="config().getRecvByteBufAllocator().&lt;br&gt;newHandle()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="520" y="460" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-33" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#330000;dashed=1;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-32" target="OfD6Csn-yZZ42Vhgxint-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-32" value="new &lt;b&gt;AdaptiveRecvByteBufAllocator&lt;/b&gt;()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;创建NioSocketChannelConfig时创建&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="800" y="460" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-39" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-36" target="OfD6Csn-yZZ42Vhgxint-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-126" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#FF3333;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-36" target="OfD6Csn-yZZ42Vhgxint-125" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-36" value="alloc.ioBuffer(guess())" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="540" y="580" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-38" value="return nextReceiveBufferSize" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="820" y="580" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-45" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-40" target="OfD6Csn-yZZ42Vhgxint-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-40" value="directBuffer(initialCapacity)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="820" y="640" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-47" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-44" target="OfD6Csn-yZZ42Vhgxint-46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-44" value="newDirectBuffer(initialCapacity, maxCapacity)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1060" y="640" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-90" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-46" target="OfD6Csn-yZZ42Vhgxint-89" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-92" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;dashed=1;shape=link;fillColor=#d5e8d4;strokeColor=#82b366;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-46" target="OfD6Csn-yZZ42Vhgxint-85" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-96" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-46" target="OfD6Csn-yZZ42Vhgxint-95" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-46" value="&lt;b&gt;PoolThreadCache&lt;/b&gt; cache = threadCache.get();&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;客户端连接Channel初始化时创建的&lt;br&gt;PoolThreadLocalCache&lt;br&gt;本地缓存中的PoolThreadCache是newDirectBuffer时创建&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1300" y="630" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-51" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-48" target="OfD6Csn-yZZ42Vhgxint-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-48" value="buf = directArena.allocate(cache, initialCapacity, maxCapacity);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1300" y="920" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-53" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-50" target="OfD6Csn-yZZ42Vhgxint-52" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-55" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-50" target="OfD6Csn-yZZ42Vhgxint-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-50" value="PooledByteBuf&amp;lt;T&amp;gt; buf = &lt;b&gt;newByteBuf&lt;/b&gt;(maxCapacity)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;只是建了个空壳ByteBuf&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1590" y="920" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-57" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-52" target="OfD6Csn-yZZ42Vhgxint-56" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-52" value="&lt;b&gt;allocate(cache, buf, reqCapacity)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;内存分配核心实现&lt;/font&gt;&lt;br&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1610" y="990" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-54" value="PooledUnsafeDirectByteBuf&lt;br&gt;.newInstance(maxCapacity)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1860" y="920" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-59" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-56" target="OfD6Csn-yZZ42Vhgxint-60" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1960" y="1060" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-56" value="normCapacity = normalizeCapacity(reqCapacity)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;2^9&amp;lt;reqCapacity&amp;lt;2^24时就是求大于等于reqCapacity的最小2次幂&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1860" y="980" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-73" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-60" target="OfD6Csn-yZZ42Vhgxint-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-74" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-60" target="OfD6Csn-yZZ42Vhgxint-61" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-75" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-60" target="OfD6Csn-yZZ42Vhgxint-65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-76" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-60" target="OfD6Csn-yZZ42Vhgxint-66" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-60" value="&lt;font color=&quot;#330000&quot; style=&quot;font-size: 9px&quot;&gt;按normCapacity大小分配&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;rounded=1;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1900" y="1150" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-15" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-61" target="pRMBg5NHesNb8MRIFpo1-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-61" value="Small&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;测试中指定的1024,属于small&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2080" y="1120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-20" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-63" target="pRMBg5NHesNb8MRIFpo1-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-63" value="Tiny" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2080" y="1060" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-24" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-65" target="pRMBg5NHesNb8MRIFpo1-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-65" value="cache.allocateNormal()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2080" y="2080" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-26" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-66" target="pRMBg5NHesNb8MRIFpo1-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-66" value="cache.allocateHuge()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2080" y="2140" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-72" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-69" target="OfD6Csn-yZZ42Vhgxint-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-78" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-69" target="OfD6Csn-yZZ42Vhgxint-77" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-69" value="regionCache = cacheForSmall(area, normCapacity)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2440" y="1120" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-122" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-71" target="OfD6Csn-yZZ42Vhgxint-121" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-71" value="allocate(cache, buf, reqCapacity)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2440" y="1301" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-80" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-77" target="OfD6Csn-yZZ42Vhgxint-79" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-77" value="idx = PoolArena&lt;br&gt;.smallIdx(normCapacity)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;normCapacity是1024×2^(?-1) 次幂&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2640" y="1120" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-82" value="Y" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-79" target="OfD6Csn-yZZ42Vhgxint-81" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-84" value="N" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-79" target="OfD6Csn-yZZ42Vhgxint-83" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-79" value="area.isDirect()" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2680" y="1190" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-81" value="cache(&lt;b&gt;smallSubPageDirectCaches&lt;/b&gt;, idx)&lt;br&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;返回smallSubPageDirectCaches中第idx个元素&lt;/font&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2800" y="1180" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-83" value="cache(smallSubPageHeapCaches, idx)" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2800" y="1241" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-88" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-85" target="OfD6Csn-yZZ42Vhgxint-87" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-85" value="threadCache = new &lt;b&gt;PoolThreadLocalCache&lt;/b&gt;(useCacheForAllThreads)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;useCacheForAllThreads默认true&lt;br&gt;每个PooledByteBufAllocator都有一个PoolThreadLocalCache,是PoolThreadCache线程本地缓存&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1100" y="330" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-94" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-87" target="OfD6Csn-yZZ42Vhgxint-93" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-87" value="&lt;div&gt;this.tinyCacheSize = tinyCacheSize;&lt;/div&gt;&lt;div&gt;this.smallCacheSize = smallCacheSize;&lt;/div&gt;&lt;div&gt;this.normalCacheSize = normalCacheSize;&lt;/div&gt;&lt;div&gt;chunkSize = validateAndCalculateChunkSize(pageSize, maxOrder)&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1080" y="420" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-91" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-89" target="OfD6Csn-yZZ42Vhgxint-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-89" value="&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PoolArena&amp;lt;ByteBuffer&amp;gt; directArena = cache.directArena;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1300" y="840" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-93" value="&lt;div&gt;创建directArenas数组&lt;br&gt;和directArenaMetrics不可修改的List&lt;br&gt;metric = new PooledByteBufAllocatorMetric(this)&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1120" y="504" width="200" height="46" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-98" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-95" target="OfD6Csn-yZZ42Vhgxint-97" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-95" value="InternalThreadLocalMap threadLocalMap = InternalThreadLocalMap.get()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1580" y="640" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-100" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-97" target="OfD6Csn-yZZ42Vhgxint-99" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-97" value="Object v = threadLocalMap.indexedVariable(index)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;v已设置就返回，未设置则继续往下&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1580" y="700" width="240" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-103" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-99" target="OfD6Csn-yZZ42Vhgxint-102" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1840" y="780" />
              <mxPoint x="1840" y="660" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-99" value="initialize(threadLocalMap)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;新建了个PoolThreadCache实例&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1620" y="760" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-101" value="FastThreadLocal" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1660" y="620" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-105" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-102" target="OfD6Csn-yZZ42Vhgxint-104" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-109" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-102" target="OfD6Csn-yZZ42Vhgxint-108" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-102" value="v = initialValue()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1880" y="640" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-107" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-104" target="OfD6Csn-yZZ42Vhgxint-106" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-104" value="threadLocalMap.setIndexedVariable(&lt;br&gt;index, v)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;将PoolThreadCache加入线程本地Map&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1860" y="700" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-106" value="addToVariablesToRemove(&lt;br&gt;threadLocalMap, this);&lt;br&gt;return v;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1860" y="760" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-112" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-108" target="OfD6Csn-yZZ42Vhgxint-111" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-108" value="initialValue()&lt;br&gt;&lt;font style=&quot;font-size: 8px&quot; color=&quot;#007fff&quot;&gt;这个代码里面包含堆内存和直接内存的初始化，这里只分析直接内存&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2120" y="640" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-110" value="PooledByteBufAllocator$PoolThreadLocalCache" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2090" y="620" width="220" height="20" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-114" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-111" target="OfD6Csn-yZZ42Vhgxint-113" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-111" value="PoolArena&amp;lt;ByteBuffer&amp;gt; directArena = leastUsedArena(directArenas)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;前面创建了2*CPU_CORE个Arena,选择一个最少使用(numThreadCaches最小)的用于当前线程内存管理&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2320" y="630" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-116" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-113" target="OfD6Csn-yZZ42Vhgxint-115" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-113" value="PoolArena&amp;lt;ByteBuffer&amp;gt; directArena = leastUsedArena(directArenas)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2320" y="720" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-118" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-115" target="OfD6Csn-yZZ42Vhgxint-117" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-115" value="&lt;div&gt;PoolThreadCache cache = new &lt;b&gt;PoolThreadCache&lt;/b&gt;(&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; heapArena, directArena, tinyCacheSize, smallCacheSize, normalCacheSize,&lt;/div&gt;&lt;div&gt;DEFAULT_MAX_CACHED_BUFFER_CAPACITY, DEFAULT_CACHE_TRIM_INTERVAL)&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2280" y="780" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-4" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#330000;strokeColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-117" target="pRMBg5NHesNb8MRIFpo1-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-117" value="&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;this.freeSweepAllocationThreshold = freeSweepAllocationThreshold;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;this.heapArena = heapArena;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px&quot;&gt;&lt;font style=&quot;font-size: 9px&quot;&gt;this.directArena = directArena;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2660" y="790" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-120" value="PoolThreadLocalCache 是在线程本地分配的PoolThreadCache" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="1380" y="300" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-121" value="allocated = cache.allocate(buf, reqCapacity)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;MemoryRegionCache是已分配可复用的内存块队列缓存&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2640" y="1301" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-0" value="io.netty.buffer.PooledByteBufAllocator" style="swimlane;startSize=20;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="-520" y="380" width="480" height="220" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-3" value="&lt;div&gt;private final PoolArena&amp;lt;byte[]&amp;gt;[] heapArenas;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;font color=&quot;#007fff&quot;&gt;//分配堆内存相关，暂略&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final &lt;b&gt;PoolArena&amp;lt;ByteBuffer&amp;gt;[] directArenas&lt;/b&gt;;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;//管理直接内存，默认创建２×CPU核心数个Arena,Arena是内存管理器&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final int tinyCacheSize;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//默认512&amp;nbsp; &amp;nbsp;&lt;/font&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/div&gt;&lt;div&gt;private final int smallCacheSize;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;font color=&quot;#007fff&quot;&gt;//默认256&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final int normalCacheSize;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; //默认64&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final List&amp;lt;PoolArenaMetric&amp;gt; heapArenaMetrics;&amp;nbsp; &amp;nbsp;&lt;font color=&quot;#007fff&quot;&gt;//分配堆内存相关，暂略&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final &lt;b&gt;List&amp;lt;PoolArenaMetric&amp;gt; directArenaMetrics&lt;/b&gt;; &lt;font color=&quot;#007fff&quot;&gt;//&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final &lt;b&gt;PoolThreadLocalCache threadCache&lt;/b&gt;;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;font color=&quot;#007fff&quot;&gt;//存储PoolThreadCache的线程本地缓存&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final int chunkSize;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;font color=&quot;#007fff&quot;&gt; &amp;nbsp; //页大小默认是8192B(2^13B),chunk最大上限是1GB(2^30B),chunk实际大小是8192&amp;lt;&amp;lt;maxOrder(11)=16MB计算出来的；order还有阶数的意思&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final PooledByteBufAllocatorMetric metric;&amp;nbsp; &lt;font color=&quot;#cc0066&quot;&gt;//？？？实现PooledByteBufAllocator和&lt;/font&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" parent="T2kqkVEU3U_L5cV3mocF-0" vertex="1">
          <mxGeometry y="20" width="480" height="200" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-4" value="io.netty.buffer.PoolArena" style="swimlane;startSize=20;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="-1040" y="380" width="480" height="420" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-5" value="&lt;div&gt;final PooledByteBufAllocator parent;&lt;/div&gt;&lt;div&gt;private final int maxOrder;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;font color=&quot;#007fff&quot;&gt;//阶次(11)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;final int pageSize;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;//8192B&lt;/font&gt;&lt;/div&gt;&lt;div&gt;final int pageShifts;&amp;nbsp; &amp;nbsp;&lt;font color=&quot;#007fff&quot;&gt;//page的大小是２的多少次幂（13）&lt;/font&gt;&lt;/div&gt;&lt;div&gt;final int chunkSize;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//默认16M = pageSize*2^maxOrder&lt;/font&gt;&lt;/div&gt;&lt;div&gt;final int subpageOverflowMask;&amp;nbsp;&lt;font color=&quot;#007fff&quot;&gt; //-8192 ???&lt;/font&gt;&lt;/div&gt;&lt;div&gt;final int numSmallSubpagePools; &lt;font color=&quot;#007fff&quot;&gt;//4&lt;/font&gt;&lt;/div&gt;&lt;div&gt;final int directMemoryCacheAlignment;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp;//0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;final int directMemoryCacheAlignmentMask;&amp;nbsp; &amp;nbsp;&lt;font color=&quot;#007fff&quot;&gt;//-1&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final &lt;b&gt;PoolSubpage&lt;/b&gt;&amp;lt;T&amp;gt;[] &lt;b&gt;tinySubpagePools&lt;/b&gt;;&amp;nbsp; &amp;nbsp;&lt;font color=&quot;#007fff&quot;&gt; //管理subpage分配(对page更细粒度的分配，分配16B、32B、48B ...... 496B大小的subpage)，这里有32个档位，数组有32个PoolSubpage元素，每个PoolSubpage管理一个档位的内存分配，每个PoolSubpage都是一个双向链表&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final &lt;b&gt;PoolSubpage&lt;/b&gt;&amp;lt;T&amp;gt;[] &lt;b&gt;smallSubpagePools&lt;/b&gt;;&amp;nbsp; &amp;nbsp;&lt;font color=&quot;#007fff&quot;&gt;//管理subpage分配(对page更细粒度的分配,分配512B、1024B、2048B、4096B大小的subpage), 这里分了４个档位，每个PoolSubpage都是一个双向链表&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;//下面PoolChunkList构成一个双向链表(头节点只有next)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final &lt;b&gt;PoolChunkList&lt;/b&gt;&amp;lt;T&amp;gt; &lt;b&gt;q050&lt;/b&gt;;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//内存使用率50%-100%&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final &lt;b&gt;PoolChunkList&lt;/b&gt;&amp;lt;T&amp;gt; &lt;b&gt;q025&lt;/b&gt;;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//内存使用率25%-75%&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final &lt;b&gt;PoolChunkList&lt;/b&gt;&amp;lt;T&amp;gt; &lt;b&gt;q000&lt;/b&gt;;&amp;nbsp; &amp;nbsp; &lt;font color=&quot;#007fff&quot;&gt;//内存使用率1%-50%&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final &lt;b&gt;PoolChunkList&lt;/b&gt;&amp;lt;T&amp;gt; &lt;b&gt;qInit&lt;/b&gt;;&lt;span&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//链表头节点，内存使用率0%-25%&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final &lt;b&gt;PoolChunkList&lt;/b&gt;&amp;lt;T&amp;gt; &lt;b&gt;q075&lt;/b&gt;;&lt;font color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; //内存使用率75%-100%&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final &lt;b&gt;PoolChunkList&lt;/b&gt;&amp;lt;T&amp;gt; &lt;b&gt;q100&lt;/b&gt;;&amp;nbsp; &amp;nbsp;&lt;font color=&quot;#007fff&quot;&gt; //内存使用率100%&lt;/font&gt;&lt;/div&gt;&lt;div&gt;private final List&amp;lt;PoolChunkListMetric&amp;gt; chunkListMetrics;&lt;/div&gt;&lt;div&gt;private long allocationsNormal;&lt;/div&gt;&lt;div&gt;private final LongCounter allocationsTiny = PlatformDependent.newLongCounter();&lt;/div&gt;&lt;div&gt;private final LongCounter allocationsSmall = PlatformDependent.newLongCounter();&lt;/div&gt;&lt;div&gt;private final LongCounter allocationsHuge = PlatformDependent.newLongCounter();&lt;/div&gt;&lt;div&gt;private final LongCounter activeBytesHuge = PlatformDependent.newLongCounter();&lt;/div&gt;&lt;div&gt;private long deallocationsTiny;&lt;/div&gt;&lt;div&gt;private long deallocationsSmall;&lt;/div&gt;&lt;div&gt;private long deallocationsNormal;&lt;/div&gt;&lt;div&gt;private final LongCounter deallocationsHuge = PlatformDependent.newLongCounter();&lt;/div&gt;&lt;div&gt;final AtomicInteger &lt;b&gt;numThreadCaches&lt;/b&gt; = new AtomicInteger();&lt;span&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;//PoolArena管理的PoolThreadCache数量&lt;/font&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" parent="T2kqkVEU3U_L5cV3mocF-4" vertex="1">
          <mxGeometry y="20" width="480" height="400" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.25;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;curved=1;entryX=1;entryY=0;entryDx=0;entryDy=0;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-3" target="T2kqkVEU3U_L5cV3mocF-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-550" y="380" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-540" y="450" />
              <mxPoint x="-540" y="380" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-127" value="&lt;font color=&quot;#007fff&quot;&gt;Y&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=9;fontColor=#FF3333;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-125" target="OfD6Csn-yZZ42Vhgxint-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-129" value="&lt;font color=&quot;#007fff&quot;&gt;N&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="OfD6Csn-yZZ42Vhgxint-125" target="OfD6Csn-yZZ42Vhgxint-128" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-125" value="&lt;font color=&quot;#330000&quot; style=&quot;font-size: 8px&quot;&gt;是否支持Unsafe?&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=9;fontColor=#FF3333;rounded=1;arcSize=9;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="700" y="680" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="OfD6Csn-yZZ42Vhgxint-128" value="heapBuffer(initialCapacity)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;暂略&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="820" y="720" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-0" value="&lt;h1&gt;&lt;span style=&quot;font-size: 12px ; font-weight: 400&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;可参考学习内容：&lt;/font&gt;&lt;/span&gt;&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;&lt;font color=&quot;#007fff&quot;&gt;FastThreadLocalThread &amp;amp; PoolThreadLocalCache&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="800" y="19" width="480" height="161" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-6" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#330000;strokeColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="pRMBg5NHesNb8MRIFpo1-1" target="pRMBg5NHesNb8MRIFpo1-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-1" value="&lt;div style=&quot;font-size: 8px&quot;&gt;&lt;div&gt;&lt;b&gt;tinySubPageDirectCaches&lt;/b&gt; = createSubPageCaches(tinyCacheSize, PoolArena.numTinySubpagePools, SizeClass.Tiny);&lt;/div&gt;&lt;div&gt;&lt;b&gt;smallSubPageDirectCaches&lt;/b&gt; = createSubPageCaches(smallCacheSize, directArena.numSmallSubpagePools, SizeClass.Small);&lt;/div&gt;&lt;div&gt;&lt;b&gt;numShiftsNormalDirect&lt;/b&gt; = log2(directArena.pageSize);&lt;/div&gt;&lt;div&gt;&lt;b&gt;normalDirectCaches&lt;/b&gt; = createNormalCaches(normalCacheSize, maxCachedBufferCapacity, directArena);&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2620" y="850" width="280" height="90" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-5" value="&lt;span&gt;directArena.&lt;b&gt;numThreadCaches&lt;br&gt;&lt;/b&gt;.getAndIncrement()&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;font-size: 8px&quot;&gt;directArena管理的PoolThreadCache计数加1&lt;/span&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=center;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2660" y="960" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-7" value="io.netty.buffer.PoolThreadCache" style="swimlane;startSize=20;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="-520" y="821" width="480" height="299" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-8" value="&lt;div&gt;heapArena = {PoolArena$HeapArena@1213} &quot;Chunk(s) at 0~25%:\nnone\nChunk(s) at 0~50%:\nnone\nChunk(s) at 25~75%:\nnone\nChunk(s) at 50~100%:\nnone\nChunk(s) at 75~100%:\nnone\nChunk(s) at 100%:\nnone\ntiny subpages:\nsmall subpages:\n&quot;&lt;/div&gt;&lt;div&gt;&lt;b&gt;directArena&lt;/b&gt; = {PoolArena$DirectArena@1266} &quot;Chunk(s) at 0~25%:\nnone\nChunk(s) at 0~50%:\nnone\nChunk(s) at 25~75%:\nnone\nChunk(s) at 50~100%:\nnone\nChunk(s) at 75~100%:\nnone\nChunk(s) at 100%:\nnone\ntiny subpages:\nsmall subpages:\n&quot;&lt;/div&gt;&lt;div&gt;tinySubPageHeapCaches = {PoolThreadCache$MemoryRegionCache[32]@1564}&amp;nbsp;&lt;/div&gt;&lt;div&gt;smallSubPageHeapCaches = {PoolThreadCache$MemoryRegionCache[4]@1587}&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;b&gt;tinySubPageDirectCaches&lt;/b&gt; = {PoolThreadCache$&lt;b&gt;MemoryRegionCache&lt;/b&gt;[32]@1489}&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;b&gt;smallSubPageDirectCaches&lt;/b&gt; = {PoolThreadCache$&lt;b&gt;MemoryRegionCache&lt;/b&gt;[4]@1503}&amp;nbsp;&lt;/div&gt;&lt;div&gt;normalHeapCaches = {PoolThreadCache$MemoryRegionCache[3]@1623}&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;b&gt;normalDirectCaches&lt;/b&gt; = {PoolThreadCache$MemoryRegionCache[3]@1521}&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;b&gt;numShiftsNormalDirect&lt;/b&gt; = 13&lt;/div&gt;&lt;div&gt;numShiftsNormalHeap = 13&lt;/div&gt;&lt;div&gt;freeSweepAllocationThreshold = 8192&lt;/div&gt;&lt;div&gt;freed = {AtomicBoolean@1456} &quot;false&quot;&lt;/div&gt;&lt;div&gt;allocations = 0&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" parent="pRMBg5NHesNb8MRIFpo1-7" vertex="1">
          <mxGeometry y="20" width="480" height="280" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-9" value="io.netty.buffer.PoolThreadCache$MemoryRegionCache" style="swimlane;startSize=20;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="-1040" y="821" width="480" height="140" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-11" value="&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 10px&quot;&gt;private final int size;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 10px&quot;&gt;private final Queue&amp;lt;Entry&amp;lt;T&amp;gt;&amp;gt; queue;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 10px&quot;&gt;private final SizeClass sizeClass;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px&quot;&gt;&lt;font color=&quot;#330000&quot; style=&quot;font-size: 10px&quot;&gt;private int allocations;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=8;fontColor=#007FFF;" parent="pRMBg5NHesNb8MRIFpo1-9" vertex="1">
          <mxGeometry y="20" width="480" height="120" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-12" value="MemoryRegionCache" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2690" y="1281" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-16" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="pRMBg5NHesNb8MRIFpo1-14" target="OfD6Csn-yZZ42Vhgxint-69" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-28" value="首次运行&lt;br&gt;上面肯定会获取失败&lt;br&gt;继续往下" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="pRMBg5NHesNb8MRIFpo1-14" target="pRMBg5NHesNb8MRIFpo1-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-14" value="cache.allocateSmall()&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;这个意思是先尝试从已分配被返还的内存块缓存中拿&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2240" y="1120" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-19" value="cache.allocateTiny()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2240" y="1060" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-23" value="cache.allocateNormal()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2240" y="2080" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-25" value="cache.allocateHuge()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2240" y="2140" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-30" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#330000;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="oKPWLzEbPb163pztiOSI-1" source="pRMBg5NHesNb8MRIFpo1-27" target="pRMBg5NHesNb8MRIFpo1-31" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2320" y="1420" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-27" value="&lt;div&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;tableIdx = smallIdx(normCapacity);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;font-size: 10px&quot;&gt;table = &lt;b&gt;smallSubpagePools&lt;/b&gt;;&lt;br&gt;PoolSubpage&amp;lt;T&amp;gt; head = table[tableIdx];&lt;/font&gt;&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;tableIdx=1,&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 9px&quot;&gt;smallSubpagePools的四个数组元素什么区别？&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2220" y="1360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-34" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;dashed=1;" parent="oKPWLzEbPb163pztiOSI-1" source="pRMBg5NHesNb8MRIFpo1-31" target="pRMBg5NHesNb8MRIFpo1-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-35" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="pRMBg5NHesNb8MRIFpo1-31" target="pRMBg5NHesNb8MRIFpo1-36" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2460" y="1530" as="targetPoint" />
            <Array as="points">
              <mxPoint x="2320" y="1480" />
              <mxPoint x="2520" y="1480" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-31" value="synchronized (head)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2220" y="1440" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-18" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="pRMBg5NHesNb8MRIFpo1-33" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2320" y="1760" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-33" value="synchronized end" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2220" y="1720" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-10" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="pRMBg5NHesNb8MRIFpo1-36" target="T2kqkVEU3U_L5cV3mocF-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-36" value="PoolSubpage&amp;lt;T&amp;gt; s = head.next" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2420" y="1500" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-40" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;strokeColor=#330000;" parent="oKPWLzEbPb163pztiOSI-1" source="pRMBg5NHesNb8MRIFpo1-37" target="pRMBg5NHesNb8MRIFpo1-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-37" value="long handle = s.allocate()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2600" y="1560" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-12" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="pRMBg5NHesNb8MRIFpo1-39" target="T2kqkVEU3U_L5cV3mocF-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-39" value="s.chunk.&lt;b&gt;initBufWithSubpage&lt;/b&gt;(&lt;br&gt;buf, null, handle, reqCapacity)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2600" y="1620" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="pRMBg5NHesNb8MRIFpo1-41" value="为什么取第2个PoolSubPage实例？" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2420" y="1375" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-9" value="Y" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-8" target="pRMBg5NHesNb8MRIFpo1-37" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-15" value="N" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-8" target="pRMBg5NHesNb8MRIFpo1-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-8" value="s != head ?" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2480" y="1560" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-11" value="incTinySmallAllocation(tiny)&lt;br&gt;return" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2600" y="1680" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-24" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-21" target="T2kqkVEU3U_L5cV3mocF-23" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2320" y="1790" />
              <mxPoint x="2520" y="1790" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-21" value="synchronized (this)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2220" y="1760" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Cdyh7PiPrUsoKKtQj6mc-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-22" target="Cdyh7PiPrUsoKKtQj6mc-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-22" value="synchronized end" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2220" y="1900" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-25" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-23" target="T2kqkVEU3U_L5cV3mocF-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2520" y="1880" />
              <mxPoint x="2320" y="1880" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-27" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-23" target="T2kqkVEU3U_L5cV3mocF-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-23" value="allocateNormal(buf, reqCapacity, normCapacity)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2440" y="1820" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-29" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-26" target="T2kqkVEU3U_L5cV3mocF-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-26" value="依次尝试从q050、q025、q000、qInit、q075中分配" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2640" y="1820" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-31" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-28" target="T2kqkVEU3U_L5cV3mocF-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-35" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-28" target="T2kqkVEU3U_L5cV3mocF-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-28" value="PoolChunk&amp;lt;T&amp;gt; c = newChunk(pageSize, maxOrder, pageShifts, chunkSize);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2640" y="1880" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-33" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-30" target="T2kqkVEU3U_L5cV3mocF-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-30" value="&lt;div&gt;new &lt;b&gt;PoolChunk&lt;/b&gt;&amp;lt;ByteBuffer&amp;gt;(this,&lt;/div&gt;&lt;div&gt;&lt;b&gt;allocateDirect&lt;/b&gt;(chunkSize), pageSize, maxOrder,&amp;nbsp;&lt;span&gt;pageShifts, chunkSize, 0)&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2840" y="1880" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-32" value="ByteBuffer.allocateDirect(capacity)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;可以看到最终直接内存还是通过ByteBuffer用Unsafe分配的，capacity是16M&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="3080" y="1880" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-37" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-34" target="T2kqkVEU3U_L5cV3mocF-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Cdyh7PiPrUsoKKtQj6mc-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-34" target="Cdyh7PiPrUsoKKtQj6mc-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-34" value="success = c.allocate(buf, reqCapacity, normCapacity)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2640" y="1960" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-45" value="Y" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-36" target="T2kqkVEU3U_L5cV3mocF-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-47" value="N" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-36" target="T2kqkVEU3U_L5cV3mocF-46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-36" value="&lt;font style=&quot;font-size: 8px&quot;&gt;(normCapacity &amp;amp; subpageOverflowMask) != 0&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;即申请的容量是否大于subpage最大容量&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2840" y="1950" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-44" value="handle =&amp;nbsp; allocateRun(normCapacity)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="3000" y="1960" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-49" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-46" target="T2kqkVEU3U_L5cV3mocF-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-46" value="handle = allocateSubpage(normCapacity)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="3000" y="2020" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-51" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-48" target="T2kqkVEU3U_L5cV3mocF-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-48" value="PoolSubpage&amp;lt;T&amp;gt; head = arena.findSubpagePoolHead(normCapacity)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;查找负责此档位内存分配的PoolSubpage&lt;br&gt;测试中指定的是1024，属于smallSubpagePools中索引为１的SubpagePool负责处理&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="3200" y="2010" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-53" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=8;fontColor=#007FFF;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-50" target="T2kqkVEU3U_L5cV3mocF-52" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3300" y="2120" />
              <mxPoint x="3420" y="2120" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-50" value="synchronized (head)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="3200" y="2090" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Cdyh7PiPrUsoKKtQj6mc-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="oKPWLzEbPb163pztiOSI-1" source="T2kqkVEU3U_L5cV3mocF-52" target="Cdyh7PiPrUsoKKtQj6mc-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T2kqkVEU3U_L5cV3mocF-52" value="id = allocateNode(d)&lt;br&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 8px&quot;&gt;查找某深度可分配的内存的的索引&lt;br&gt;并将分支上的父节点深度值+1&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="3320" y="2140" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Cdyh7PiPrUsoKKtQj6mc-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="oKPWLzEbPb163pztiOSI-1" source="Cdyh7PiPrUsoKKtQj6mc-0" target="Cdyh7PiPrUsoKKtQj6mc-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Cdyh7PiPrUsoKKtQj6mc-0" value="freeBytes -= pageSize;&lt;br&gt;subpageIdx = subpageIdx(id);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="3320" y="2200" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Cdyh7PiPrUsoKKtQj6mc-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="oKPWLzEbPb163pztiOSI-1" source="Cdyh7PiPrUsoKKtQj6mc-4" target="Cdyh7PiPrUsoKKtQj6mc-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Cdyh7PiPrUsoKKtQj6mc-4" value="subpage = new PoolSubpage&amp;lt;T&amp;gt;(head, this, id, runOffset(id), pageSize, normCapacity)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="3320" y="2260" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Cdyh7PiPrUsoKKtQj6mc-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="oKPWLzEbPb163pztiOSI-1" source="Cdyh7PiPrUsoKKtQj6mc-6" target="Cdyh7PiPrUsoKKtQj6mc-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Cdyh7PiPrUsoKKtQj6mc-6" value="subpage.allocate()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="3320" y="2320" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Cdyh7PiPrUsoKKtQj6mc-8" value="initBuf(buf, nioBuffer, handle, reqCapacity)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="3560" y="2320" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Cdyh7PiPrUsoKKtQj6mc-10" value="qInit.add(c);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2640" y="2040" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Cdyh7PiPrUsoKKtQj6mc-12" value="incTinySmallAllocation(tiny)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="oKPWLzEbPb163pztiOSI-1" vertex="1">
          <mxGeometry x="2220" y="1940" width="200" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
